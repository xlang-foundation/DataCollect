import{J as be,K as it,d as ut,r as re,k as st,L as ct,A as ft,c as de,m as rr,b as te,j as K,M as tr,t as ve,F as nr,z as or,w as oe,e as we,g as lt,N as dt,i as he,o as me,O as Ie,E as ge,_ as vt}from"./index-CiQqSHAU.js";import{g as ht}from"./label-D3p7TSLS.js";import"./request-CR0pEiE3.js";const $=[];for(let _=0;_<256;++_)$.push((_+256).toString(16).slice(1));function mt(_,N=0){return($[_[N+0]]+$[_[N+1]]+$[_[N+2]]+$[_[N+3]]+"-"+$[_[N+4]]+$[_[N+5]]+"-"+$[_[N+6]]+$[_[N+7]]+"-"+$[_[N+8]]+$[_[N+9]]+"-"+$[_[N+10]]+$[_[N+11]]+$[_[N+12]]+$[_[N+13]]+$[_[N+14]]+$[_[N+15]]).toLowerCase()}let Oe;const gt=new Uint8Array(16);function pt(){if(!Oe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Oe=crypto.getRandomValues.bind(crypto)}return Oe(gt)}const yt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ar={randomUUID:yt};function ir(_,N,z){var I;if(ar.randomUUID&&!_)return ar.randomUUID();_=_||{};const b=_.random??((I=_.rng)==null?void 0:I.call(_))??pt();if(b.length<16)throw new Error("Random bytes length must be >= 16");return b[6]=b[6]&15|64,b[8]=b[8]&63|128,mt(b)}function Ee(_){throw new Error('Could not dynamically require "'+_+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Pe={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var ur;function _t(){return ur||(ur=1,function(_,N){(function(z){_.exports=z()})(function(){return function z(b,I,E){function A(x,C){if(!I[x]){if(!b[x]){var h=typeof Ee=="function"&&Ee;if(!C&&h)return h(x,!0);if(w)return w(x,!0);var g=new Error("Cannot find module '"+x+"'");throw g.code="MODULE_NOT_FOUND",g}var B=I[x]={exports:{}};b[x][0].call(B.exports,function(L){var W=b[x][1][L];return A(W||L)},B,B.exports,z,b,I,E)}return I[x].exports}for(var w=typeof Ee=="function"&&Ee,T=0;T<E.length;T++)A(E[T]);return A}({1:[function(z,b,I){(function(E){var A=E.MutationObserver||E.WebKitMutationObserver,w;if(A){var T=0,x=new A(L),C=E.document.createTextNode("");x.observe(C,{characterData:!0}),w=function(){C.data=T=++T%2}}else if(!E.setImmediate&&typeof E.MessageChannel<"u"){var h=new E.MessageChannel;h.port1.onmessage=L,w=function(){h.port2.postMessage(0)}}else"document"in E&&"onreadystatechange"in E.document.createElement("script")?w=function(){var O=E.document.createElement("script");O.onreadystatechange=function(){L(),O.onreadystatechange=null,O.parentNode.removeChild(O),O=null},E.document.documentElement.appendChild(O)}:w=function(){setTimeout(L,0)};var g,B=[];function L(){g=!0;for(var O,H,F=B.length;F;){for(H=B,B=[],O=-1;++O<F;)H[O]();F=B.length}g=!1}b.exports=W;function W(O){B.push(O)===1&&!g&&w()}}).call(this,typeof be<"u"?be:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(z,b,I){var E=z(1);function A(){}var w={},T=["REJECTED"],x=["FULFILLED"],C=["PENDING"];b.exports=h;function h(i){if(typeof i!="function")throw new TypeError("resolver must be a function");this.state=C,this.queue=[],this.outcome=void 0,i!==A&&W(this,i)}h.prototype.catch=function(i){return this.then(null,i)},h.prototype.then=function(i,v){if(typeof i!="function"&&this.state===x||typeof v!="function"&&this.state===T)return this;var d=new this.constructor(A);if(this.state!==C){var p=this.state===x?i:v;B(d,p,this.outcome)}else this.queue.push(new g(d,i,v));return d};function g(i,v,d){this.promise=i,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof d=="function"&&(this.onRejected=d,this.callRejected=this.otherCallRejected)}g.prototype.callFulfilled=function(i){w.resolve(this.promise,i)},g.prototype.otherCallFulfilled=function(i){B(this.promise,this.onFulfilled,i)},g.prototype.callRejected=function(i){w.reject(this.promise,i)},g.prototype.otherCallRejected=function(i){B(this.promise,this.onRejected,i)};function B(i,v,d){E(function(){var p;try{p=v(d)}catch(S){return w.reject(i,S)}p===i?w.reject(i,new TypeError("Cannot resolve promise with itself")):w.resolve(i,p)})}w.resolve=function(i,v){var d=O(L,v);if(d.status==="error")return w.reject(i,d.value);var p=d.value;if(p)W(i,p);else{i.state=x,i.outcome=v;for(var S=-1,P=i.queue.length;++S<P;)i.queue[S].callFulfilled(v)}return i},w.reject=function(i,v){i.state=T,i.outcome=v;for(var d=-1,p=i.queue.length;++d<p;)i.queue[d].callRejected(v);return i};function L(i){var v=i&&i.then;if(i&&(typeof i=="object"||typeof i=="function")&&typeof v=="function")return function(){v.apply(i,arguments)}}function W(i,v){var d=!1;function p(M){d||(d=!0,w.reject(i,M))}function S(M){d||(d=!0,w.resolve(i,M))}function P(){v(S,p)}var k=O(P);k.status==="error"&&p(k.value)}function O(i,v){var d={};try{d.value=i(v),d.status="success"}catch(p){d.status="error",d.value=p}return d}h.resolve=H;function H(i){return i instanceof this?i:w.resolve(new this(A),i)}h.reject=F;function F(i){var v=new this(A);return w.reject(v,i)}h.all=ue;function ue(i){var v=this;if(Object.prototype.toString.call(i)!=="[object Array]")return this.reject(new TypeError("must be an array"));var d=i.length,p=!1;if(!d)return this.resolve([]);for(var S=new Array(d),P=0,k=-1,M=new this(A);++k<d;)V(i[k],k);return M;function V(q,ne){v.resolve(q).then(ae,function(X){p||(p=!0,w.reject(M,X))});function ae(X){S[ne]=X,++P===d&&!p&&(p=!0,w.resolve(M,S))}}}h.race=Q;function Q(i){var v=this;if(Object.prototype.toString.call(i)!=="[object Array]")return this.reject(new TypeError("must be an array"));var d=i.length,p=!1;if(!d)return this.resolve([]);for(var S=-1,P=new this(A);++S<d;)k(i[S]);return P;function k(M){v.resolve(M).then(function(V){p||(p=!0,w.resolve(P,V))},function(V){p||(p=!0,w.reject(P,V))})}}},{1:1}],3:[function(z,b,I){(function(E){typeof E.Promise!="function"&&(E.Promise=z(2))}).call(this,typeof be<"u"?be:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(z,b,I){var E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var T=w();function x(){try{if(!T||!T.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||t)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function C(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if(n.name!=="TypeError")throw n;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new r,a=0;a<e.length;a+=1)o.append(e[a]);return o.getBlob(t.type)}}typeof Promise>"u"&&z(3);var h=Promise;function g(e,t){t&&e.then(function(r){t(null,r)},function(r){t(r)})}function B(e,t,r){typeof t=="function"&&e.then(t),typeof r=="function"&&e.catch(r)}function L(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function W(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var O="local-forage-detect-blob-support",H=void 0,F={},ue=Object.prototype.toString,Q="readonly",i="readwrite";function v(e){for(var t=e.length,r=new ArrayBuffer(t),o=new Uint8Array(r),a=0;a<t;a++)o[a]=e.charCodeAt(a);return r}function d(e){return new h(function(t){var r=e.transaction(O,i),o=C([""]);r.objectStore(O).put(o,"key"),r.onabort=function(a){a.preventDefault(),a.stopPropagation(),t(!1)},r.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function p(e){return typeof H=="boolean"?h.resolve(H):d(e).then(function(t){return H=t,H})}function S(e){var t=F[e.name],r={};r.promise=new h(function(o,a){r.resolve=o,r.reject=a}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function P(e){var t=F[e.name],r=t.deferredOperations.pop();if(r)return r.resolve(),r.promise}function k(e,t){var r=F[e.name],o=r.deferredOperations.pop();if(o)return o.reject(t),o.promise}function M(e,t){return new h(function(r,o){if(F[e.name]=F[e.name]||ce(),e.db)if(t)S(e),e.db.close();else return r(e.db);var a=[e.name];t&&a.push(e.version);var n=T.open.apply(T,a);t&&(n.onupgradeneeded=function(u){var s=n.result;try{s.createObjectStore(e.storeName),u.oldVersion<=1&&s.createObjectStore(O)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+u.oldVersion+" to version "+u.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),n.onerror=function(u){u.preventDefault(),o(n.error)},n.onsuccess=function(){var u=n.result;u.onversionchange=function(s){s.target.close()},r(u),P(e)}})}function V(e){return M(e,!1)}function q(e){return M(e,!0)}function ne(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,a=e.version>e.db.version;if(o&&(e.version!==t&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||r){if(r){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function ae(e){return new h(function(t,r){var o=new FileReader;o.onerror=r,o.onloadend=function(a){var n=btoa(a.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},o.readAsBinaryString(e)})}function X(e){var t=v(atob(e.data));return C([t],{type:e.type})}function se(e){return e&&e.__local_forage_encoded_blob}function pe(e){var t=this,r=t._initReady().then(function(){var o=F[t._dbInfo.name];if(o&&o.dbReady)return o.dbReady});return B(r,e,e),r}function J(e){S(e);for(var t=F[e.name],r=t.forages,o=0;o<r.length;o++){var a=r[o];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,V(e).then(function(n){return e.db=n,ne(e)?q(e):n}).then(function(n){e.db=t.db=n;for(var u=0;u<r.length;u++)r[u]._dbInfo.db=n}).catch(function(n){throw k(e,n),n})}function j(e,t,r,o){o===void 0&&(o=1);try{var a=e.db.transaction(e.storeName,t);r(null,a)}catch(n){if(o>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return h.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),q(e)}).then(function(){return J(e).then(function(){j(e,t,r,o-1)})}).catch(r);r(n)}}function ce(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function cr(e){var t=this,r={db:null};if(e)for(var o in e)r[o]=e[o];var a=F[r.name];a||(a=ce(),F[r.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=pe);var n=[];function u(){return h.resolve()}for(var s=0;s<a.forages.length;s++){var c=a.forages[s];c!==t&&n.push(c._initReady().catch(u))}var f=a.forages.slice(0);return h.all(n).then(function(){return r.db=a.db,V(r)}).then(function(l){return r.db=l,ne(r,t._defaultConfig.version)?q(r):l}).then(function(l){r.db=a.db=l,t._dbInfo=r;for(var m=0;m<f.length;m++){var y=f[m];y!==t&&(y._dbInfo.db=r.db,y._dbInfo.version=r.version)}})}function fr(e,t){var r=this;e=L(e);var o=new h(function(a,n){r.ready().then(function(){j(r._dbInfo,Q,function(u,s){if(u)return n(u);try{var c=s.objectStore(r._dbInfo.storeName),f=c.get(e);f.onsuccess=function(){var l=f.result;l===void 0&&(l=null),se(l)&&(l=X(l)),a(l)},f.onerror=function(){n(f.error)}}catch(l){n(l)}})}).catch(n)});return g(o,t),o}function lr(e,t){var r=this,o=new h(function(a,n){r.ready().then(function(){j(r._dbInfo,Q,function(u,s){if(u)return n(u);try{var c=s.objectStore(r._dbInfo.storeName),f=c.openCursor(),l=1;f.onsuccess=function(){var m=f.result;if(m){var y=m.value;se(y)&&(y=X(y));var D=e(y,m.key,l++);D!==void 0?a(D):m.continue()}else a()},f.onerror=function(){n(f.error)}}catch(m){n(m)}})}).catch(n)});return g(o,t),o}function dr(e,t,r){var o=this;e=L(e);var a=new h(function(n,u){var s;o.ready().then(function(){return s=o._dbInfo,ue.call(t)==="[object Blob]"?p(s.db).then(function(c){return c?t:ae(t)}):t}).then(function(c){j(o._dbInfo,i,function(f,l){if(f)return u(f);try{var m=l.objectStore(o._dbInfo.storeName);c===null&&(c=void 0);var y=m.put(c,e);l.oncomplete=function(){c===void 0&&(c=null),n(c)},l.onabort=l.onerror=function(){var D=y.error?y.error:y.transaction.error;u(D)}}catch(D){u(D)}})}).catch(u)});return g(a,r),a}function vr(e,t){var r=this;e=L(e);var o=new h(function(a,n){r.ready().then(function(){j(r._dbInfo,i,function(u,s){if(u)return n(u);try{var c=s.objectStore(r._dbInfo.storeName),f=c.delete(e);s.oncomplete=function(){a()},s.onerror=function(){n(f.error)},s.onabort=function(){var l=f.error?f.error:f.transaction.error;n(l)}}catch(l){n(l)}})}).catch(n)});return g(o,t),o}function hr(e){var t=this,r=new h(function(o,a){t.ready().then(function(){j(t._dbInfo,i,function(n,u){if(n)return a(n);try{var s=u.objectStore(t._dbInfo.storeName),c=s.clear();u.oncomplete=function(){o()},u.onabort=u.onerror=function(){var f=c.error?c.error:c.transaction.error;a(f)}}catch(f){a(f)}})}).catch(a)});return g(r,e),r}function mr(e){var t=this,r=new h(function(o,a){t.ready().then(function(){j(t._dbInfo,Q,function(n,u){if(n)return a(n);try{var s=u.objectStore(t._dbInfo.storeName),c=s.count();c.onsuccess=function(){o(c.result)},c.onerror=function(){a(c.error)}}catch(f){a(f)}})}).catch(a)});return g(r,e),r}function gr(e,t){var r=this,o=new h(function(a,n){if(e<0){a(null);return}r.ready().then(function(){j(r._dbInfo,Q,function(u,s){if(u)return n(u);try{var c=s.objectStore(r._dbInfo.storeName),f=!1,l=c.openKeyCursor();l.onsuccess=function(){var m=l.result;if(!m){a(null);return}e===0||f?a(m.key):(f=!0,m.advance(e))},l.onerror=function(){n(l.error)}}catch(m){n(m)}})}).catch(n)});return g(o,t),o}function pr(e){var t=this,r=new h(function(o,a){t.ready().then(function(){j(t._dbInfo,Q,function(n,u){if(n)return a(n);try{var s=u.objectStore(t._dbInfo.storeName),c=s.openKeyCursor(),f=[];c.onsuccess=function(){var l=c.result;if(!l){o(f);return}f.push(l.key),l.continue()},c.onerror=function(){a(c.error)}}catch(l){a(l)}})}).catch(a)});return g(r,e),r}function yr(e,t){t=W.apply(this,arguments);var r=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o=this,a;if(!e.name)a=h.reject("Invalid arguments");else{var n=e.name===r.name&&o._dbInfo.db,u=n?h.resolve(o._dbInfo.db):V(e).then(function(s){var c=F[e.name],f=c.forages;c.db=s;for(var l=0;l<f.length;l++)f[l]._dbInfo.db=s;return s});e.storeName?a=u.then(function(s){if(s.objectStoreNames.contains(e.storeName)){var c=s.version+1;S(e);var f=F[e.name],l=f.forages;s.close();for(var m=0;m<l.length;m++){var y=l[m];y._dbInfo.db=null,y._dbInfo.version=c}var D=new h(function(R,Y){var U=T.open(e.name,c);U.onerror=function(G){var le=U.result;le.close(),Y(G)},U.onupgradeneeded=function(){var G=U.result;G.deleteObjectStore(e.storeName)},U.onsuccess=function(){var G=U.result;G.close(),R(G)}});return D.then(function(R){f.db=R;for(var Y=0;Y<l.length;Y++){var U=l[Y];U._dbInfo.db=R,P(U._dbInfo)}}).catch(function(R){throw(k(e,R)||h.resolve()).catch(function(){}),R})}}):a=u.then(function(s){S(e);var c=F[e.name],f=c.forages;s.close();for(var l=0;l<f.length;l++){var m=f[l];m._dbInfo.db=null}var y=new h(function(D,R){var Y=T.deleteDatabase(e.name);Y.onerror=function(){var U=Y.result;U&&U.close(),R(Y.error)},Y.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},Y.onsuccess=function(){var U=Y.result;U&&U.close(),D(U)}});return y.then(function(D){c.db=D;for(var R=0;R<f.length;R++){var Y=f[R];P(Y._dbInfo)}}).catch(function(D){throw(k(e,D)||h.resolve()).catch(function(){}),D})})}return g(a,t),a}var _r={_driver:"asyncStorage",_initStorage:cr,_support:x(),iterate:lr,getItem:fr,setItem:dr,removeItem:vr,clear:hr,length:mr,key:gr,keys:pr,dropInstance:yr};function br(){return typeof openDatabase=="function"}var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wr="~~local_forage_type~",Ue=/^~~local_forage_type~([^~]+)~/,ye="__lfsc__:",De=ye.length,Re="arbf",xe="blob",Fe="si08",ke="ui08",Me="uic8",Ye="si16",$e="si32",ze="ur16",Ve="ui32",We="fl32",je="fl64",Ke=De+Re.length,Ge=Object.prototype.toString;function He(e){var t=e.length*.75,r=e.length,o,a=0,n,u,s,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var f=new ArrayBuffer(t),l=new Uint8Array(f);for(o=0;o<r;o+=4)n=Z.indexOf(e[o]),u=Z.indexOf(e[o+1]),s=Z.indexOf(e[o+2]),c=Z.indexOf(e[o+3]),l[a++]=n<<2|u>>4,l[a++]=(u&15)<<4|s>>2,l[a++]=(s&3)<<6|c&63;return f}function Te(e){var t=new Uint8Array(e),r="",o;for(o=0;o<t.length;o+=3)r+=Z[t[o]>>2],r+=Z[(t[o]&3)<<4|t[o+1]>>4],r+=Z[(t[o+1]&15)<<2|t[o+2]>>6],r+=Z[t[o+2]&63];return t.length%3===2?r=r.substring(0,r.length-1)+"=":t.length%3===1&&(r=r.substring(0,r.length-2)+"=="),r}function Ir(e,t){var r="";if(e&&(r=Ge.call(e)),e&&(r==="[object ArrayBuffer]"||e.buffer&&Ge.call(e.buffer)==="[object ArrayBuffer]")){var o,a=ye;e instanceof ArrayBuffer?(o=e,a+=Re):(o=e.buffer,r==="[object Int8Array]"?a+=Fe:r==="[object Uint8Array]"?a+=ke:r==="[object Uint8ClampedArray]"?a+=Me:r==="[object Int16Array]"?a+=Ye:r==="[object Uint16Array]"?a+=ze:r==="[object Int32Array]"?a+=$e:r==="[object Uint32Array]"?a+=Ve:r==="[object Float32Array]"?a+=We:r==="[object Float64Array]"?a+=je:t(new Error("Failed to get type for BinaryArray"))),t(a+Te(o))}else if(r==="[object Blob]"){var n=new FileReader;n.onload=function(){var u=wr+e.type+"~"+Te(this.result);t(ye+xe+u)},n.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(u){console.error("Couldn't convert value into a JSON string: ",e),t(null,u)}}function Er(e){if(e.substring(0,De)!==ye)return JSON.parse(e);var t=e.substring(Ke),r=e.substring(De,Ke),o;if(r===xe&&Ue.test(t)){var a=t.match(Ue);o=a[1],t=t.substring(a[0].length)}var n=He(t);switch(r){case Re:return n;case xe:return C([n],{type:o});case Fe:return new Int8Array(n);case ke:return new Uint8Array(n);case Me:return new Uint8ClampedArray(n);case Ye:return new Int16Array(n);case ze:return new Uint16Array(n);case $e:return new Int32Array(n);case Ve:return new Uint32Array(n);case We:return new Float32Array(n);case je:return new Float64Array(n);default:throw new Error("Unkown type: "+r)}}var Ae={serialize:Ir,deserialize:Er,stringToBuffer:He,bufferToString:Te};function Qe(e,t,r,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,o)}function Sr(e){var t=this,r={db:null};if(e)for(var o in e)r[o]=typeof e[o]!="string"?e[o].toString():e[o];var a=new h(function(n,u){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(s){return u(s)}r.db.transaction(function(s){Qe(s,r,function(){t._dbInfo=r,n()},function(c,f){u(f)})},u)});return r.serializer=Ae,a}function ee(e,t,r,o,a,n){e.executeSql(r,o,a,function(u,s){s.code===s.SYNTAX_ERR?u.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(c,f){f.rows.length?n(c,s):Qe(c,t,function(){c.executeSql(r,o,a,n)},n)},n):n(u,s)},n)}function Dr(e,t){var r=this;e=L(e);var o=new h(function(a,n){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(s){ee(s,u,"SELECT * FROM "+u.storeName+" WHERE key = ? LIMIT 1",[e],function(c,f){var l=f.rows.length?f.rows.item(0).value:null;l&&(l=u.serializer.deserialize(l)),a(l)},function(c,f){n(f)})})}).catch(n)});return g(o,t),o}function Rr(e,t){var r=this,o=new h(function(a,n){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(s){ee(s,u,"SELECT * FROM "+u.storeName,[],function(c,f){for(var l=f.rows,m=l.length,y=0;y<m;y++){var D=l.item(y),R=D.value;if(R&&(R=u.serializer.deserialize(R)),R=e(R,D.key,y+1),R!==void 0){a(R);return}}a()},function(c,f){n(f)})})}).catch(n)});return g(o,t),o}function Xe(e,t,r,o){var a=this;e=L(e);var n=new h(function(u,s){a.ready().then(function(){t===void 0&&(t=null);var c=t,f=a._dbInfo;f.serializer.serialize(t,function(l,m){m?s(m):f.db.transaction(function(y){ee(y,f,"INSERT OR REPLACE INTO "+f.storeName+" (key, value) VALUES (?, ?)",[e,l],function(){u(c)},function(D,R){s(R)})},function(y){if(y.code===y.QUOTA_ERR){if(o>0){u(Xe.apply(a,[e,c,r,o-1]));return}s(y)}})})}).catch(s)});return g(n,r),n}function xr(e,t,r){return Xe.apply(this,[e,t,r,1])}function Tr(e,t){var r=this;e=L(e);var o=new h(function(a,n){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(s){ee(s,u,"DELETE FROM "+u.storeName+" WHERE key = ?",[e],function(){a()},function(c,f){n(f)})})}).catch(n)});return g(o,t),o}function Ar(e){var t=this,r=new h(function(o,a){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(u){ee(u,n,"DELETE FROM "+n.storeName,[],function(){o()},function(s,c){a(c)})})}).catch(a)});return g(r,e),r}function Nr(e){var t=this,r=new h(function(o,a){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(u){ee(u,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(s,c){var f=c.rows.item(0).c;o(f)},function(s,c){a(c)})})}).catch(a)});return g(r,e),r}function Cr(e,t){var r=this,o=new h(function(a,n){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(s){ee(s,u,"SELECT key FROM "+u.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,f){var l=f.rows.length?f.rows.item(0).key:null;a(l)},function(c,f){n(f)})})}).catch(n)});return g(o,t),o}function Br(e){var t=this,r=new h(function(o,a){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(u){ee(u,n,"SELECT key FROM "+n.storeName,[],function(s,c){for(var f=[],l=0;l<c.rows.length;l++)f.push(c.rows.item(l).key);o(f)},function(s,c){a(c)})})}).catch(a)});return g(r,e),r}function Lr(e){return new h(function(t,r){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(a,n){for(var u=[],s=0;s<n.rows.length;s++)u.push(n.rows.item(s).name);t({db:e,storeNames:u})},function(a,n){r(n)})},function(o){r(o)})})}function Or(e,t){t=W.apply(this,arguments);var r=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var o=this,a;return e.name?a=new h(function(n){var u;e.name===r.name?u=o._dbInfo.db:u=openDatabase(e.name,"","",0),e.storeName?n({db:u,storeNames:[e.storeName]}):n(Lr(u))}).then(function(n){return new h(function(u,s){n.db.transaction(function(c){function f(D){return new h(function(R,Y){c.executeSql("DROP TABLE IF EXISTS "+D,[],function(){R()},function(U,G){Y(G)})})}for(var l=[],m=0,y=n.storeNames.length;m<y;m++)l.push(f(n.storeNames[m]));h.all(l).then(function(){u()}).catch(function(D){s(D)})},function(c){s(c)})})}):a=h.reject("Invalid arguments"),g(a,t),a}var Pr={_driver:"webSQLStorage",_initStorage:Sr,_support:br(),iterate:Rr,getItem:Dr,setItem:xr,removeItem:Tr,clear:Ar,length:Nr,key:Cr,keys:Br,dropInstance:Or};function Ur(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Je(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function Fr(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function kr(){return!Fr()||localStorage.length>0}function Mr(e){var t=this,r={};if(e)for(var o in e)r[o]=e[o];return r.keyPrefix=Je(e,t._defaultConfig),kr()?(t._dbInfo=r,r.serializer=Ae,h.resolve()):h.reject()}function Yr(e){var t=this,r=t.ready().then(function(){for(var o=t._dbInfo.keyPrefix,a=localStorage.length-1;a>=0;a--){var n=localStorage.key(a);n.indexOf(o)===0&&localStorage.removeItem(n)}});return g(r,e),r}function $r(e,t){var r=this;e=L(e);var o=r.ready().then(function(){var a=r._dbInfo,n=localStorage.getItem(a.keyPrefix+e);return n&&(n=a.serializer.deserialize(n)),n});return g(o,t),o}function zr(e,t){var r=this,o=r.ready().then(function(){for(var a=r._dbInfo,n=a.keyPrefix,u=n.length,s=localStorage.length,c=1,f=0;f<s;f++){var l=localStorage.key(f);if(l.indexOf(n)===0){var m=localStorage.getItem(l);if(m&&(m=a.serializer.deserialize(m)),m=e(m,l.substring(u),c++),m!==void 0)return m}}});return g(o,t),o}function Vr(e,t){var r=this,o=r.ready().then(function(){var a=r._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(a.keyPrefix.length)),n});return g(o,t),o}function Wr(e){var t=this,r=t.ready().then(function(){for(var o=t._dbInfo,a=localStorage.length,n=[],u=0;u<a;u++){var s=localStorage.key(u);s.indexOf(o.keyPrefix)===0&&n.push(s.substring(o.keyPrefix.length))}return n});return g(r,e),r}function jr(e){var t=this,r=t.keys().then(function(o){return o.length});return g(r,e),r}function Kr(e,t){var r=this;e=L(e);var o=r.ready().then(function(){var a=r._dbInfo;localStorage.removeItem(a.keyPrefix+e)});return g(o,t),o}function Gr(e,t,r){var o=this;e=L(e);var a=o.ready().then(function(){t===void 0&&(t=null);var n=t;return new h(function(u,s){var c=o._dbInfo;c.serializer.serialize(t,function(f,l){if(l)s(l);else try{localStorage.setItem(c.keyPrefix+e,f),u(n)}catch(m){(m.name==="QuotaExceededError"||m.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s(m),s(m)}})})});return g(a,r),a}function Hr(e,t){if(t=W.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var o=this,a;return e.name?a=new h(function(n){e.storeName?n(Je(e,o._defaultConfig)):n(e.name+"/")}).then(function(n){for(var u=localStorage.length-1;u>=0;u--){var s=localStorage.key(u);s.indexOf(n)===0&&localStorage.removeItem(s)}}):a=h.reject("Invalid arguments"),g(a,t),a}var Qr={_driver:"localStorageWrapper",_initStorage:Mr,_support:Ur(),iterate:zr,getItem:$r,setItem:Gr,removeItem:Kr,clear:Yr,length:jr,key:Vr,keys:Wr,dropInstance:Hr},Xr=function(t,r){return t===r||typeof t=="number"&&typeof r=="number"&&isNaN(t)&&isNaN(r)},Jr=function(t,r){for(var o=t.length,a=0;a<o;){if(Xr(t[a],r))return!0;a++}return!1},qe=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},fe={},Ze={},ie={INDEXEDDB:_r,WEBSQL:Pr,LOCALSTORAGE:Qr},qr=[ie.INDEXEDDB._driver,ie.WEBSQL._driver,ie.LOCALSTORAGE._driver],_e=["dropInstance"],Ne=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(_e),Zr={description:"",driver:qr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function et(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function Ce(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(qe(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var rt=function(){function e(t){A(this,e);for(var r in ie)if(ie.hasOwnProperty(r)){var o=ie[r],a=o._driver;this[r]=a,fe[a]||this.defineDriver(o)}this._defaultConfig=Ce({},Zr),this._config=Ce({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(r){if((typeof r>"u"?"undefined":E(r))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in r){if(o==="storeName"&&(r[o]=r[o].replace(/\W/g,"_")),o==="version"&&typeof r[o]!="number")return new Error("Database version must be a number.");this._config[o]=r[o]}return"driver"in r&&r.driver?this.setDriver(this._config.driver):!0}else return typeof r=="string"?this._config[r]:this._config},e.prototype.defineDriver=function(r,o,a){var n=new h(function(u,s){try{var c=r._driver,f=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!r._driver){s(f);return}for(var l=Ne.concat("_initStorage"),m=0,y=l.length;m<y;m++){var D=l[m],R=!Jr(_e,D);if((R||r[D])&&typeof r[D]!="function"){s(f);return}}var Y=function(){for(var le=function(ot){return function(){var at=new Error("Method "+ot+" is not implemented by the current driver"),er=h.reject(at);return g(er,arguments[arguments.length-1]),er}},Be=0,nt=_e.length;Be<nt;Be++){var Le=_e[Be];r[Le]||(r[Le]=le(Le))}};Y();var U=function(le){fe[c]&&console.info("Redefining LocalForage driver: "+c),fe[c]=r,Ze[c]=le,u()};"_support"in r?r._support&&typeof r._support=="function"?r._support().then(U,s):U(!!r._support):U(!0)}catch(G){s(G)}});return B(n,o,a),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(r,o,a){var n=fe[r]?h.resolve(fe[r]):h.reject(new Error("Driver not found."));return B(n,o,a),n},e.prototype.getSerializer=function(r){var o=h.resolve(Ae);return B(o,r),o},e.prototype.ready=function(r){var o=this,a=o._driverSet.then(function(){return o._ready===null&&(o._ready=o._initDriver()),o._ready});return B(a,r,r),a},e.prototype.setDriver=function(r,o,a){var n=this;qe(r)||(r=[r]);var u=this._getSupportedDrivers(r);function s(){n._config.driver=n.driver()}function c(m){return n._extend(m),s(),n._ready=n._initStorage(n._config),n._ready}function f(m){return function(){var y=0;function D(){for(;y<m.length;){var R=m[y];return y++,n._dbInfo=null,n._ready=null,n.getDriver(R).then(c).catch(D)}s();var Y=new Error("No available storage method found.");return n._driverSet=h.reject(Y),n._driverSet}return D()}}var l=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=l.then(function(){var m=u[0];return n._dbInfo=null,n._ready=null,n.getDriver(m).then(function(y){n._driver=y._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=f(u)})}).catch(function(){s();var m=new Error("No available storage method found.");return n._driverSet=h.reject(m),n._driverSet}),B(this._driverSet,o,a),this._driverSet},e.prototype.supports=function(r){return!!Ze[r]},e.prototype._extend=function(r){Ce(this,r)},e.prototype._getSupportedDrivers=function(r){for(var o=[],a=0,n=r.length;a<n;a++){var u=r[a];this.supports(u)&&o.push(u)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var r=0,o=Ne.length;r<o;r++)et(this,Ne[r])},e.prototype.createInstance=function(r){return new e(r)},e}(),tt=new rt;b.exports=tt},{3:3}]},{},[4])(4)})}(Pe)),Pe.exports}var bt=_t();const Se=it(bt);async function sr(_){return new Promise((N,z)=>{const b=new FileReader;b.onload=I=>{var E;(E=I.target)!=null&&E.result?N(I.target.result):z(new Error("Failed to read blob data"))},b.onerror=()=>{z(b.error||new Error("Unknown error occurred"))},b.readAsDataURL(_)})}const wt={class:"take-photos-view"},It={id:"video",playsinline:"",autoplay:""},Et={class:"imgdrawer-box"},St=["src"],Dt={class:"img-info"},Rt={class:"location blur-background"},xt={class:"time blur-background"},Tt={style:{gap:"2px","margin-top":"1em",display:"flex","flex-wrap":"wrap"}},At={class:"grid-container"},Nt=["onClick"],Ct={class:"image-wrapper"},Bt=["src"],Lt=ut({__name:"TakePhotosView",setup(_){function N(){if(x.value){const i=C.value.findIndex(v=>v.value===x.value.value);i!==-1&&(i===C.value.length-1?x.value=C.value[0]:x.value=C.value[i+1])}}const z=re(null),b=re(!1),I=re(null),E=Se.createInstance({driver:Se.INDEXEDDB,name:"image-storage",storeName:"images"});Se.setDriver(Se.INDEXEDDB);const A=re([]);E.iterate((i,v,d)=>{console.log(i,v,d),i&&A.value.push(i)});const w=re([]);st(async()=>{const i=await ht();w.value=i});const T=ct(),x=re(),C=re([]);function h(){navigator.mediaDevices.enumerateDevices().then(B).catch(L)}h(),ft(x,(i,v)=>{if(i){const d=document.getElementById("video");if(d&&d.srcObject){const p=d.srcObject.getTracks();for(let S=0;S!==p.length;++S)p[S].stop()}navigator.mediaDevices.getUserMedia({video:{deviceId:i.deviceInfo.deviceId}}).then(function(p){const S=document.getElementById("video");S.srcObject=p}).catch(L)}});function g(i){b.value=!0,w.value.forEach(v=>{var d;v.checked=((d=i==null?void 0:i.labels)==null?void 0:d.includes(v.label))||!1}),i!=null&&i.labels?(i.labels=w.value.filter(v=>v.checked).map(v=>v.label),E.setItem(i.id.toString(),Ie(i)).then(()=>{I.value=Ie(i),b.value=!0}).catch(v=>{console.error(v)})):i.labels=[]}function B(i){for(let v=0;v!==i.length;++v){const d=i[v];d.kind==="videoinput"&&d.label.includes("back")&&C.value.push({label:d.label||`camera ${C.value.length+1}`,value:d.deviceId,deviceInfo:d})}if(x.value&&x.value.length===0)for(let v=0;v!==i.length;++v){const d=i[v];d.kind==="videoinput"&&C.value.push({label:d.label||`camera ${C.value.length+1}`,value:d.deviceId,deviceInfo:d})}console.log(C.value),x.value=C.value[0]}function L(i){console.log("navigator.MediaDevices.getUserMedia error: ",i.message,i.name)}function W(){var v;if(b.value){b.value=!1,x.value=null;return}const i=document.getElementById("video");if(i&&i.srcObject){const d=(v=i==null?void 0:i.srcObject)==null?void 0:v.getVideoTracks()[0];if(d){let p=new ImageCapture(d);const S=ir();p.takePhoto().then(async P=>{const k=await sr(P),M={id:S,dataUrl:k,gps:{accuracy:T.gps.accuracy,coords:{latitude:T.gps.coords.latitude,longitude:T.gps.coords.longitude},timestamp:T.gps.timestamp},shotTime:Date.now(),labels:[]};E.setItem(M.id.toString(),M).then(()=>{console.log("Image stored successfully"),ge({message:"mage stored successfully",type:"success"}),A.value.push(M),I.value=M,b.value=!0}).catch(V=>{ge({message:"Error storing image:"+V.message,type:"error"})})}).catch(P=>{console.error("takePhoto() error: ",P)})}}}function O(){console.log(I.value),I.value&&E.removeItem(I.value.id.toString()).then(()=>{console.log("Image removed successfully");const i=A.value.findIndex(v=>{var d;return v.id===((d=I.value)==null?void 0:d.id)});i!==-1&&A.value.splice(i,1),ge({message:"Image removed successfully",type:"success"}),b.value=!1}).catch(i=>{ge.error("Error removing image:",i)}).finally(()=>{b.value=!1})}const H=async i=>{if(i.raw){const v=ir(),d={id:v,dataUrl:await sr(i.raw),gps:{accuracy:T.gps.accuracy,coords:{latitude:T.gps.coords.latitude,longitude:T.gps.coords.longitude},timestamp:T.gps.timestamp},shotTime:Date.now()};E.setItem(v,d),A.value.push(d),I.value=d,b.value=!0}},F=re(null),ue=()=>{},Q=async(i,v)=>{if(i.checked=v,i=Ie(i),!!i&&I.value){I.value.labels=w.value.filter(d=>d.checked).map(d=>d.label);try{const d=I.value.id.toString(),p=Ie(I.value);await E.setItem(d,p);const S=A.value.findIndex(P=>{var k;return P.id===((k=I.value)==null?void 0:k.id)});S!==-1&&(A.value[S]=I.value)}catch(d){console.log(d),ge.error("标签更新失败: "+d)}}};return(i,v)=>{var k,M,V,q,ne,ae,X,se,pe;const d=we("el-check-tag"),p=we("el-button"),S=we("el-popconfirm"),P=we("el-upload");return me(),de("div",wt,[rr(K("video",It,null,512),[[tr,!b.value]]),rr(K("div",Et,[K("img",{class:"imgdrawer",ref_key:"imgdrawer",ref:z,src:(k=I.value)==null?void 0:k.dataUrl,alt:""},null,8,St),K("div",Dt,[K("div",Rt,[K("div",null,"纬度:"+ve((q=(V=(M=I.value)==null?void 0:M.gps)==null?void 0:V.coords)==null?void 0:q.latitude),1),K("div",null,"经度:"+ve((X=(ae=(ne=I.value)==null?void 0:ne.gps)==null?void 0:ae.coords)==null?void 0:X.longitude),1)]),K("div",xt,"GPS Time:"+ve((pe=(se=I.value)==null?void 0:se.gps)==null?void 0:pe.timestamp),1),K("div",Tt,[(me(!0),de(nr,null,or(w.value,(J,j)=>(me(),de("div",{key:j},[te(d,{checked:J.checked,onChange:ce=>{Q(J,ce)}},{default:oe(()=>[he(ve(J.checked?"✅":"")+" "+ve(J.label),1)]),_:2},1032,["checked","onChange"])]))),128))]),te(S,{title:"确认删除?",onConfirm:O},{reference:oe(()=>[te(p,{class:"delete-item",type:"danger"},{default:oe(()=>v[0]||(v[0]=[he("删除")])),_:1})]),_:1})])],512),[[tr,b.value]]),te(p,{class:"camera-select",icon:lt(dt),circle:"",onClick:N},null,8,["icon"]),te(p,{class:"shot-btn",type:"danger",onClick:W},{default:oe(()=>v[1]||(v[1]=[he(" 拍照 ")])),_:1}),te(p,{class:"upload-btn",type:"success",onClick:ue},{default:oe(()=>v[2]||(v[2]=[he(" 上传 ")])),_:1}),te(P,{ref_key:"upload",ref:F,"show-file-list":!1,class:"select-from-phone-btn",accept:"image/jpeg, image/png, image/gif, image/*",action:"",limit:1,onChange:H,"auto-upload":!1},{trigger:oe(()=>[te(p,{type:"primary"},{default:oe(()=>v[3]||(v[3]=[he("从手机中选择")])),_:1})]),_:1},512),v[4]||(v[4]=K("p",{style:{"padding-left":"8px"}},"待上传列表: ",-1)),K("div",At,[(me(!0),de(nr,null,or(A.value,(J,j)=>(me(),de("div",{key:j,class:"grid-item",onClick:ce=>g(J)},[K("div",Ct,[K("img",{src:J.dataUrl,alt:"photo",class:"square-image"},null,8,Bt)])],8,Nt))),128))])])}}}),kt=vt(Lt,[["__scopeId","data-v-7b5ffa78"]]);export{kt as default};
