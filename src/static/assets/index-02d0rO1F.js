import{g as M,r as N,d as R}from"./user-qPQteS17.js";import{d as T,x as r,o as $,k as z,i as b,z as I,g as a,a as t,C as n,R as A,c as G,p as i,t as h,G as w,S as j,f as V,_ as H}from"./index-csrz31wk.js";const J={class:"user-container"},K={class:"header"},O=T({__name:"index",setup(P){const c=r(!1),f=r(!1),u=r(!1),y=r([]),d=r(),x=r(localStorage.getItem("username")||""),o=r({username:"",display_name:"",password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],display_name:[{required:!0,message:"请输入显示名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},C=s=>s?new Date(s*1e3).toLocaleString():"-",_=async()=>{try{c.value=!0;const s=await M();y.value=s}catch(s){console.error("Failed to fetch users:",s)}finally{c.value=!1}},U=()=>{u.value=!0},B=async()=>{d.value&&await d.value.validate(async s=>{if(s)try{f.value=!0,await N({username:o.value.username,display_name:o.value.display_name,password:o.value.password}),w.success("添加用户成功"),u.value=!1,_()}catch(e){console.error("Failed to add user:",e)}finally{f.value=!1}})},D=async s=>{try{await j.confirm(`确定要删除用户 "${s.display_name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await R(s.username),w.success("删除成功"),_()}catch(e){e!=="cancel"&&console.error("Failed to delete user:",e)}},F=()=>{d.value&&d.value.resetFields()};return $(()=>{_()}),(s,e)=>{const m=n("el-button"),p=n("el-table-column"),L=n("el-table"),v=n("el-input"),g=n("el-form-item"),S=n("el-form"),q=n("el-dialog"),E=A("loading");return V(),z("div",J,[b("div",K,[e[6]||(e[6]=b("h2",null,"用户管理",-1)),a(m,{type:"primary",onClick:U},{default:t(()=>e[5]||(e[5]=[i("添加用户")])),_:1})]),I((V(),G(L,{data:y.value,border:"",style:{width:"100%"}},{default:t(()=>[a(p,{prop:"username",label:"用户名"}),a(p,{prop:"display_name",label:"显示名称"}),a(p,{prop:"last_login",label:"最后登录时间"},{default:t(({row:l})=>[i(h(C(l.last_login)),1)]),_:1}),a(p,{label:"操作",width:"150"},{default:t(({row:l})=>[a(m,{type:"danger",size:"small",onClick:Q=>D(l),disabled:l.username===x.value},{default:t(()=>e[7]||(e[7]=[i(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[E,c.value]]),a(q,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value=l),title:"添加用户",width:"500px",onClose:F},{footer:t(()=>[a(m,{onClick:e[3]||(e[3]=l=>u.value=!1)},{default:t(()=>e[8]||(e[8]=[i("取消")])),_:1}),a(m,{type:"primary",onClick:B,loading:f.value},{default:t(()=>e[9]||(e[9]=[i(" 确定 ")])),_:1},8,["loading"])]),default:t(()=>[a(S,{ref_key:"formRef",ref:d,model:o.value,rules:k,"label-width":"100px"},{default:t(()=>[a(g,{label:"用户名",prop:"username"},{default:t(()=>[a(v,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.username=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"显示名称",prop:"display_name"},{default:t(()=>[a(v,{modelValue:o.value.display_name,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.display_name=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"密码",prop:"password"},{default:t(()=>[a(v,{modelValue:o.value.password,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.password=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Y=H(O,[["__scopeId","data-v-394cd580"]]);export{Y as default};
