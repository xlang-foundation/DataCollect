import{J as we,K as ir,d as ur,r as te,k as sr,L as cr,A as fr,c as de,m as rt,b as re,j as K,M as nt,t as ve,F as ot,z as at,w as oe,e as Ie,g as lr,N as dr,i as he,u as vr,o as me,O as Ee,E as X,_ as hr}from"./index-DTLVf1qU.js";import{g as mr}from"./label-Cdnf2zJq.js";import{s as pr}from"./request-CDyB1Aj0.js";const W=[];for(let b=0;b<256;++b)W.push((b+256).toString(16).slice(1));function gr(b,C=0){return(W[b[C+0]]+W[b[C+1]]+W[b[C+2]]+W[b[C+3]]+"-"+W[b[C+4]]+W[b[C+5]]+"-"+W[b[C+6]]+W[b[C+7]]+"-"+W[b[C+8]]+W[b[C+9]]+"-"+W[b[C+10]]+W[b[C+11]]+W[b[C+12]]+W[b[C+13]]+W[b[C+14]]+W[b[C+15]]).toLowerCase()}let Pe;const yr=new Uint8Array(16);function _r(){if(!Pe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Pe=crypto.getRandomValues.bind(crypto)}return Pe(yr)}const br=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),it={randomUUID:br};function ut(b,C,z){var y;if(it.randomUUID&&!b)return it.randomUUID();b=b||{};const w=b.random??((y=b.rng)==null?void 0:y.call(b))??_r();if(w.length<16)throw new Error("Random bytes length must be >= 16");return w[6]=w[6]&15|64,w[8]=w[8]&63|128,gr(w)}function Se(b){throw new Error('Could not dynamically require "'+b+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ue={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var st;function wr(){return st||(st=1,function(b,C){(function(z){b.exports=z()})(function(){return function z(w,y,S){function x(A,L){if(!y[A]){if(!w[A]){var m=typeof Se=="function"&&Se;if(!L&&m)return m(A,!0);if(E)return E(A,!0);var g=new Error("Cannot find module '"+A+"'");throw g.code="MODULE_NOT_FOUND",g}var O=y[A]={exports:{}};w[A][0].call(O.exports,function(P){var j=w[A][1][P];return x(j||P)},O,O.exports,z,w,y,S)}return y[A].exports}for(var E=typeof Se=="function"&&Se,N=0;N<S.length;N++)x(S[N]);return x}({1:[function(z,w,y){(function(S){var x=S.MutationObserver||S.WebKitMutationObserver,E;if(x){var N=0,A=new x(P),L=S.document.createTextNode("");A.observe(L,{characterData:!0}),E=function(){L.data=N=++N%2}}else if(!S.setImmediate&&typeof S.MessageChannel<"u"){var m=new S.MessageChannel;m.port1.onmessage=P,E=function(){m.port2.postMessage(0)}}else"document"in S&&"onreadystatechange"in S.document.createElement("script")?E=function(){var k=S.document.createElement("script");k.onreadystatechange=function(){P(),k.onreadystatechange=null,k.parentNode.removeChild(k),k=null},S.document.documentElement.appendChild(k)}:E=function(){setTimeout(P,0)};var g,O=[];function P(){g=!0;for(var k,Q,Y=O.length;Y;){for(Q=O,O=[],k=-1;++k<Y;)Q[k]();Y=O.length}g=!1}w.exports=j;function j(k){O.push(k)===1&&!g&&E()}}).call(this,typeof we<"u"?we:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(z,w,y){var S=z(1);function x(){}var E={},N=["REJECTED"],A=["FULFILLED"],L=["PENDING"];w.exports=m;function m(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=L,this.queue=[],this.outcome=void 0,v!==x&&j(this,v)}m.prototype.catch=function(v){return this.then(null,v)},m.prototype.then=function(v,s){if(typeof v!="function"&&this.state===A||typeof s!="function"&&this.state===N)return this;var d=new this.constructor(x);if(this.state!==L){var h=this.state===A?v:s;O(d,h,this.outcome)}else this.queue.push(new g(d,v,s));return d};function g(v,s,d){this.promise=v,typeof s=="function"&&(this.onFulfilled=s,this.callFulfilled=this.otherCallFulfilled),typeof d=="function"&&(this.onRejected=d,this.callRejected=this.otherCallRejected)}g.prototype.callFulfilled=function(v){E.resolve(this.promise,v)},g.prototype.otherCallFulfilled=function(v){O(this.promise,this.onFulfilled,v)},g.prototype.callRejected=function(v){E.reject(this.promise,v)},g.prototype.otherCallRejected=function(v){O(this.promise,this.onRejected,v)};function O(v,s,d){S(function(){var h;try{h=s(d)}catch(I){return E.reject(v,I)}h===v?E.reject(v,new TypeError("Cannot resolve promise with itself")):E.resolve(v,h)})}E.resolve=function(v,s){var d=k(P,s);if(d.status==="error")return E.reject(v,d.value);var h=d.value;if(h)j(v,h);else{v.state=A,v.outcome=s;for(var I=-1,T=v.queue.length;++I<T;)v.queue[I].callFulfilled(s)}return v},E.reject=function(v,s){v.state=N,v.outcome=s;for(var d=-1,h=v.queue.length;++d<h;)v.queue[d].callRejected(s);return v};function P(v){var s=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof s=="function")return function(){s.apply(v,arguments)}}function j(v,s){var d=!1;function h(U){d||(d=!0,E.reject(v,U))}function I(U){d||(d=!0,E.resolve(v,U))}function T(){s(I,h)}var B=k(T);B.status==="error"&&h(B.value)}function k(v,s){var d={};try{d.value=v(s),d.status="success"}catch(h){d.status="error",d.value=h}return d}m.resolve=Q;function Q(v){return v instanceof this?v:E.resolve(new this(x),v)}m.reject=Y;function Y(v){var s=new this(x);return E.reject(s,v)}m.all=se;function se(v){var s=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var d=v.length,h=!1;if(!d)return this.resolve([]);for(var I=new Array(d),T=0,B=-1,U=new this(x);++B<d;)F(v[B],B);return U;function F(G,ne){s.resolve(G).then(ae,function(q){h||(h=!0,E.reject(U,q))});function ae(q){I[ne]=q,++T===d&&!h&&(h=!0,E.resolve(U,I))}}}m.race=J;function J(v){var s=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var d=v.length,h=!1;if(!d)return this.resolve([]);for(var I=-1,T=new this(x);++I<d;)B(v[I]);return T;function B(U){s.resolve(U).then(function(F){h||(h=!0,E.resolve(T,F))},function(F){h||(h=!0,E.reject(T,F))})}}},{1:1}],3:[function(z,w,y){(function(S){typeof S.Promise!="function"&&(S.Promise=z(2))}).call(this,typeof we<"u"?we:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(z,w,y){var S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function x(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function E(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var N=E();function A(){try{if(!N||!N.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function L(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new t,a=0;a<e.length;a+=1)o.append(e[a]);return o.getBlob(r.type)}}typeof Promise>"u"&&z(3);var m=Promise;function g(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function O(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function P(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function j(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var k="local-forage-detect-blob-support",Q=void 0,Y={},se=Object.prototype.toString,J="readonly",v="readwrite";function s(e){for(var r=e.length,t=new ArrayBuffer(r),o=new Uint8Array(t),a=0;a<r;a++)o[a]=e.charCodeAt(a);return t}function d(e){return new m(function(r){var t=e.transaction(k,v),o=L([""]);t.objectStore(k).put(o,"key"),t.onabort=function(a){a.preventDefault(),a.stopPropagation(),r(!1)},t.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function h(e){return typeof Q=="boolean"?m.resolve(Q):d(e).then(function(r){return Q=r,Q})}function I(e){var r=Y[e.name],t={};t.promise=new m(function(o,a){t.resolve=o,t.reject=a}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function T(e){var r=Y[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function B(e,r){var t=Y[e.name],o=t.deferredOperations.pop();if(o)return o.reject(r),o.promise}function U(e,r){return new m(function(t,o){if(Y[e.name]=Y[e.name]||ie(),e.db)if(r)I(e),e.db.close();else return t(e.db);var a=[e.name];r&&a.push(e.version);var n=N.open.apply(N,a);r&&(n.onupgradeneeded=function(i){var u=n.result;try{u.createObjectStore(e.storeName),i.oldVersion<=1&&u.createObjectStore(k)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),n.onerror=function(i){i.preventDefault(),o(n.error)},n.onsuccess=function(){var i=n.result;i.onversionchange=function(u){u.target.close()},t(i),T(e)}})}function F(e){return U(e,!1)}function G(e){return U(e,!0)}function ne(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,a=e.version>e.db.version;if(o&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function ae(e){return new m(function(r,t){var o=new FileReader;o.onerror=t,o.onloadend=function(a){var n=btoa(a.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},o.readAsBinaryString(e)})}function q(e){var r=s(atob(e.data));return L([r],{type:e.type})}function ce(e){return e&&e.__local_forage_encoded_blob}function pe(e){var r=this,t=r._initReady().then(function(){var o=Y[r._dbInfo.name];if(o&&o.dbReady)return o.dbReady});return O(t,e,e),t}function ge(e){I(e);for(var r=Y[e.name],t=r.forages,o=0;o<t.length;o++){var a=t[o];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,F(e).then(function(n){return e.db=n,ne(e)?G(e):n}).then(function(n){e.db=r.db=n;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=n}).catch(function(n){throw B(e,n),n})}function V(e,r,t,o){o===void 0&&(o=1);try{var a=e.db.transaction(e.storeName,r);t(null,a)}catch(n){if(o>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return m.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),G(e)}).then(function(){return ge(e).then(function(){V(e,r,t,o-1)})}).catch(t);t(n)}}function ie(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ye(e){var r=this,t={db:null};if(e)for(var o in e)t[o]=e[o];var a=Y[t.name];a||(a=ie(),Y[t.name]=a),a.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=pe);var n=[];function i(){return m.resolve()}for(var u=0;u<a.forages.length;u++){var c=a.forages[u];c!==r&&n.push(c._initReady().catch(i))}var f=a.forages.slice(0);return m.all(n).then(function(){return t.db=a.db,F(t)}).then(function(l){return t.db=l,ne(t,r._defaultConfig.version)?G(t):l}).then(function(l){t.db=a.db=l,r._dbInfo=t;for(var p=0;p<f.length;p++){var _=f[p];_!==r&&(_._dbInfo.db=t.db,_._dbInfo.version=t.version)}})}function ft(e,r){var t=this;e=P(e);var o=new m(function(a,n){t.ready().then(function(){V(t._dbInfo,J,function(i,u){if(i)return n(i);try{var c=u.objectStore(t._dbInfo.storeName),f=c.get(e);f.onsuccess=function(){var l=f.result;l===void 0&&(l=null),ce(l)&&(l=q(l)),a(l)},f.onerror=function(){n(f.error)}}catch(l){n(l)}})}).catch(n)});return g(o,r),o}function lt(e,r){var t=this,o=new m(function(a,n){t.ready().then(function(){V(t._dbInfo,J,function(i,u){if(i)return n(i);try{var c=u.objectStore(t._dbInfo.storeName),f=c.openCursor(),l=1;f.onsuccess=function(){var p=f.result;if(p){var _=p.value;ce(_)&&(_=q(_));var R=e(_,p.key,l++);R!==void 0?a(R):p.continue()}else a()},f.onerror=function(){n(f.error)}}catch(p){n(p)}})}).catch(n)});return g(o,r),o}function dt(e,r,t){var o=this;e=P(e);var a=new m(function(n,i){var u;o.ready().then(function(){return u=o._dbInfo,se.call(r)==="[object Blob]"?h(u.db).then(function(c){return c?r:ae(r)}):r}).then(function(c){V(o._dbInfo,v,function(f,l){if(f)return i(f);try{var p=l.objectStore(o._dbInfo.storeName);c===null&&(c=void 0);var _=p.put(c,e);l.oncomplete=function(){c===void 0&&(c=null),n(c)},l.onabort=l.onerror=function(){var R=_.error?_.error:_.transaction.error;i(R)}}catch(R){i(R)}})}).catch(i)});return g(a,t),a}function vt(e,r){var t=this;e=P(e);var o=new m(function(a,n){t.ready().then(function(){V(t._dbInfo,v,function(i,u){if(i)return n(i);try{var c=u.objectStore(t._dbInfo.storeName),f=c.delete(e);u.oncomplete=function(){a()},u.onerror=function(){n(f.error)},u.onabort=function(){var l=f.error?f.error:f.transaction.error;n(l)}}catch(l){n(l)}})}).catch(n)});return g(o,r),o}function ht(e){var r=this,t=new m(function(o,a){r.ready().then(function(){V(r._dbInfo,v,function(n,i){if(n)return a(n);try{var u=i.objectStore(r._dbInfo.storeName),c=u.clear();i.oncomplete=function(){o()},i.onabort=i.onerror=function(){var f=c.error?c.error:c.transaction.error;a(f)}}catch(f){a(f)}})}).catch(a)});return g(t,e),t}function mt(e){var r=this,t=new m(function(o,a){r.ready().then(function(){V(r._dbInfo,J,function(n,i){if(n)return a(n);try{var u=i.objectStore(r._dbInfo.storeName),c=u.count();c.onsuccess=function(){o(c.result)},c.onerror=function(){a(c.error)}}catch(f){a(f)}})}).catch(a)});return g(t,e),t}function pt(e,r){var t=this,o=new m(function(a,n){if(e<0){a(null);return}t.ready().then(function(){V(t._dbInfo,J,function(i,u){if(i)return n(i);try{var c=u.objectStore(t._dbInfo.storeName),f=!1,l=c.openKeyCursor();l.onsuccess=function(){var p=l.result;if(!p){a(null);return}e===0||f?a(p.key):(f=!0,p.advance(e))},l.onerror=function(){n(l.error)}}catch(p){n(p)}})}).catch(n)});return g(o,r),o}function gt(e){var r=this,t=new m(function(o,a){r.ready().then(function(){V(r._dbInfo,J,function(n,i){if(n)return a(n);try{var u=i.objectStore(r._dbInfo.storeName),c=u.openKeyCursor(),f=[];c.onsuccess=function(){var l=c.result;if(!l){o(f);return}f.push(l.key),l.continue()},c.onerror=function(){a(c.error)}}catch(l){a(l)}})}).catch(a)});return g(t,e),t}function yt(e,r){r=j.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,a;if(!e.name)a=m.reject("Invalid arguments");else{var n=e.name===t.name&&o._dbInfo.db,i=n?m.resolve(o._dbInfo.db):F(e).then(function(u){var c=Y[e.name],f=c.forages;c.db=u;for(var l=0;l<f.length;l++)f[l]._dbInfo.db=u;return u});e.storeName?a=i.then(function(u){if(u.objectStoreNames.contains(e.storeName)){var c=u.version+1;I(e);var f=Y[e.name],l=f.forages;u.close();for(var p=0;p<l.length;p++){var _=l[p];_._dbInfo.db=null,_._dbInfo.version=c}var R=new m(function(D,$){var M=N.open(e.name,c);M.onerror=function(H){var le=M.result;le.close(),$(H)},M.onupgradeneeded=function(){var H=M.result;H.deleteObjectStore(e.storeName)},M.onsuccess=function(){var H=M.result;H.close(),D(H)}});return R.then(function(D){f.db=D;for(var $=0;$<l.length;$++){var M=l[$];M._dbInfo.db=D,T(M._dbInfo)}}).catch(function(D){throw(B(e,D)||m.resolve()).catch(function(){}),D})}}):a=i.then(function(u){I(e);var c=Y[e.name],f=c.forages;u.close();for(var l=0;l<f.length;l++){var p=f[l];p._dbInfo.db=null}var _=new m(function(R,D){var $=N.deleteDatabase(e.name);$.onerror=function(){var M=$.result;M&&M.close(),D($.error)},$.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},$.onsuccess=function(){var M=$.result;M&&M.close(),R(M)}});return _.then(function(R){c.db=R;for(var D=0;D<f.length;D++){var $=f[D];T($._dbInfo)}}).catch(function(R){throw(B(e,R)||m.resolve()).catch(function(){}),R})})}return g(a,r),a}var _t={_driver:"asyncStorage",_initStorage:ye,_support:A(),iterate:lt,getItem:ft,setItem:dt,removeItem:vt,clear:ht,length:mt,key:pt,keys:gt,dropInstance:yt};function bt(){return typeof openDatabase=="function"}var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wt="~~local_forage_type~",Fe=/^~~local_forage_type~([^~]+)~/,_e="__lfsc__:",De=_e.length,xe="arbf",Te="blob",ke="si08",Me="ui08",Ye="uic8",$e="si16",ze="si32",Ve="ur16",We="ui32",je="fl32",Ke="fl64",Ge=De+xe.length,He=Object.prototype.toString;function Qe(e){var r=e.length*.75,t=e.length,o,a=0,n,i,u,c;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var f=new ArrayBuffer(r),l=new Uint8Array(f);for(o=0;o<t;o+=4)n=Z.indexOf(e[o]),i=Z.indexOf(e[o+1]),u=Z.indexOf(e[o+2]),c=Z.indexOf(e[o+3]),l[a++]=n<<2|i>>4,l[a++]=(i&15)<<4|u>>2,l[a++]=(u&3)<<6|c&63;return f}function Ae(e){var r=new Uint8Array(e),t="",o;for(o=0;o<r.length;o+=3)t+=Z[r[o]>>2],t+=Z[(r[o]&3)<<4|r[o+1]>>4],t+=Z[(r[o+1]&15)<<2|r[o+2]>>6],t+=Z[r[o+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function It(e,r){var t="";if(e&&(t=He.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&He.call(e.buffer)==="[object ArrayBuffer]")){var o,a=_e;e instanceof ArrayBuffer?(o=e,a+=xe):(o=e.buffer,t==="[object Int8Array]"?a+=ke:t==="[object Uint8Array]"?a+=Me:t==="[object Uint8ClampedArray]"?a+=Ye:t==="[object Int16Array]"?a+=$e:t==="[object Uint16Array]"?a+=Ve:t==="[object Int32Array]"?a+=ze:t==="[object Uint32Array]"?a+=We:t==="[object Float32Array]"?a+=je:t==="[object Float64Array]"?a+=Ke:r(new Error("Failed to get type for BinaryArray"))),r(a+Ae(o))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var i=wt+e.type+"~"+Ae(this.result);r(_e+Te+i)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),r(null,i)}}function Et(e){if(e.substring(0,De)!==_e)return JSON.parse(e);var r=e.substring(Ge),t=e.substring(De,Ge),o;if(t===Te&&Fe.test(r)){var a=r.match(Fe);o=a[1],r=r.substring(a[0].length)}var n=Qe(r);switch(t){case xe:return n;case Te:return L([n],{type:o});case ke:return new Int8Array(n);case Me:return new Uint8Array(n);case Ye:return new Uint8ClampedArray(n);case $e:return new Int16Array(n);case Ve:return new Uint16Array(n);case ze:return new Int32Array(n);case We:return new Uint32Array(n);case je:return new Float32Array(n);case Ke:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var Ne={serialize:It,deserialize:Et,stringToBuffer:Qe,bufferToString:Ae};function Xe(e,r,t,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,o)}function St(e){var r=this,t={db:null};if(e)for(var o in e)t[o]=typeof e[o]!="string"?e[o].toString():e[o];var a=new m(function(n,i){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(u){return i(u)}t.db.transaction(function(u){Xe(u,t,function(){r._dbInfo=t,n()},function(c,f){i(f)})},i)});return t.serializer=Ne,a}function ee(e,r,t,o,a,n){e.executeSql(t,o,a,function(i,u){u.code===u.SYNTAX_ERR?i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(c,f){f.rows.length?n(c,u):Xe(c,r,function(){c.executeSql(t,o,a,n)},n)},n):n(i,u)},n)}function Rt(e,r){var t=this;e=P(e);var o=new m(function(a,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(u){ee(u,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(c,f){var l=f.rows.length?f.rows.item(0).value:null;l&&(l=i.serializer.deserialize(l)),a(l)},function(c,f){n(f)})})}).catch(n)});return g(o,r),o}function Dt(e,r){var t=this,o=new m(function(a,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(u){ee(u,i,"SELECT * FROM "+i.storeName,[],function(c,f){for(var l=f.rows,p=l.length,_=0;_<p;_++){var R=l.item(_),D=R.value;if(D&&(D=i.serializer.deserialize(D)),D=e(D,R.key,_+1),D!==void 0){a(D);return}}a()},function(c,f){n(f)})})}).catch(n)});return g(o,r),o}function Je(e,r,t,o){var a=this;e=P(e);var n=new m(function(i,u){a.ready().then(function(){r===void 0&&(r=null);var c=r,f=a._dbInfo;f.serializer.serialize(r,function(l,p){p?u(p):f.db.transaction(function(_){ee(_,f,"INSERT OR REPLACE INTO "+f.storeName+" (key, value) VALUES (?, ?)",[e,l],function(){i(c)},function(R,D){u(D)})},function(_){if(_.code===_.QUOTA_ERR){if(o>0){i(Je.apply(a,[e,c,t,o-1]));return}u(_)}})})}).catch(u)});return g(n,t),n}function xt(e,r,t){return Je.apply(this,[e,r,t,1])}function Tt(e,r){var t=this;e=P(e);var o=new m(function(a,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(u){ee(u,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){a()},function(c,f){n(f)})})}).catch(n)});return g(o,r),o}function At(e){var r=this,t=new m(function(o,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){ee(i,n,"DELETE FROM "+n.storeName,[],function(){o()},function(u,c){a(c)})})}).catch(a)});return g(t,e),t}function Nt(e){var r=this,t=new m(function(o,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){ee(i,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(u,c){var f=c.rows.item(0).c;o(f)},function(u,c){a(c)})})}).catch(a)});return g(t,e),t}function Ct(e,r){var t=this,o=new m(function(a,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(u){ee(u,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,f){var l=f.rows.length?f.rows.item(0).key:null;a(l)},function(c,f){n(f)})})}).catch(n)});return g(o,r),o}function Bt(e){var r=this,t=new m(function(o,a){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){ee(i,n,"SELECT key FROM "+n.storeName,[],function(u,c){for(var f=[],l=0;l<c.rows.length;l++)f.push(c.rows.item(l).key);o(f)},function(u,c){a(c)})})}).catch(a)});return g(t,e),t}function Lt(e){return new m(function(r,t){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(a,n){for(var i=[],u=0;u<n.rows.length;u++)i.push(n.rows.item(u).name);r({db:e,storeNames:i})},function(a,n){t(n)})},function(o){t(o)})})}function Ot(e,r){r=j.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,a;return e.name?a=new m(function(n){var i;e.name===t.name?i=o._dbInfo.db:i=openDatabase(e.name,"","",0),e.storeName?n({db:i,storeNames:[e.storeName]}):n(Lt(i))}).then(function(n){return new m(function(i,u){n.db.transaction(function(c){function f(R){return new m(function(D,$){c.executeSql("DROP TABLE IF EXISTS "+R,[],function(){D()},function(M,H){$(H)})})}for(var l=[],p=0,_=n.storeNames.length;p<_;p++)l.push(f(n.storeNames[p]));m.all(l).then(function(){i()}).catch(function(R){u(R)})},function(c){u(c)})})}):a=m.reject("Invalid arguments"),g(a,r),a}var Pt={_driver:"webSQLStorage",_initStorage:St,_support:bt(),iterate:Dt,getItem:Rt,setItem:xt,removeItem:Tt,clear:At,length:Nt,key:Ct,keys:Bt,dropInstance:Ot};function Ut(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function qe(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function Ft(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function kt(){return!Ft()||localStorage.length>0}function Mt(e){var r=this,t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=qe(e,r._defaultConfig),kt()?(r._dbInfo=t,t.serializer=Ne,m.resolve()):m.reject()}function Yt(e){var r=this,t=r.ready().then(function(){for(var o=r._dbInfo.keyPrefix,a=localStorage.length-1;a>=0;a--){var n=localStorage.key(a);n.indexOf(o)===0&&localStorage.removeItem(n)}});return g(t,e),t}function $t(e,r){var t=this;e=P(e);var o=t.ready().then(function(){var a=t._dbInfo,n=localStorage.getItem(a.keyPrefix+e);return n&&(n=a.serializer.deserialize(n)),n});return g(o,r),o}function zt(e,r){var t=this,o=t.ready().then(function(){for(var a=t._dbInfo,n=a.keyPrefix,i=n.length,u=localStorage.length,c=1,f=0;f<u;f++){var l=localStorage.key(f);if(l.indexOf(n)===0){var p=localStorage.getItem(l);if(p&&(p=a.serializer.deserialize(p)),p=e(p,l.substring(i),c++),p!==void 0)return p}}});return g(o,r),o}function Vt(e,r){var t=this,o=t.ready().then(function(){var a=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(a.keyPrefix.length)),n});return g(o,r),o}function Wt(e){var r=this,t=r.ready().then(function(){for(var o=r._dbInfo,a=localStorage.length,n=[],i=0;i<a;i++){var u=localStorage.key(i);u.indexOf(o.keyPrefix)===0&&n.push(u.substring(o.keyPrefix.length))}return n});return g(t,e),t}function jt(e){var r=this,t=r.keys().then(function(o){return o.length});return g(t,e),t}function Kt(e,r){var t=this;e=P(e);var o=t.ready().then(function(){var a=t._dbInfo;localStorage.removeItem(a.keyPrefix+e)});return g(o,r),o}function Gt(e,r,t){var o=this;e=P(e);var a=o.ready().then(function(){r===void 0&&(r=null);var n=r;return new m(function(i,u){var c=o._dbInfo;c.serializer.serialize(r,function(f,l){if(l)u(l);else try{localStorage.setItem(c.keyPrefix+e,f),i(n)}catch(p){(p.name==="QuotaExceededError"||p.name==="NS_ERROR_DOM_QUOTA_REACHED")&&u(p),u(p)}})})});return g(a,t),a}function Ht(e,r){if(r=j.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var o=this,a;return e.name?a=new m(function(n){e.storeName?n(qe(e,o._defaultConfig)):n(e.name+"/")}).then(function(n){for(var i=localStorage.length-1;i>=0;i--){var u=localStorage.key(i);u.indexOf(n)===0&&localStorage.removeItem(u)}}):a=m.reject("Invalid arguments"),g(a,r),a}var Qt={_driver:"localStorageWrapper",_initStorage:Mt,_support:Ut(),iterate:zt,getItem:$t,setItem:Gt,removeItem:Kt,clear:Yt,length:jt,key:Vt,keys:Wt,dropInstance:Ht},Xt=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},Jt=function(r,t){for(var o=r.length,a=0;a<o;){if(Xt(r[a],t))return!0;a++}return!1},Ze=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},fe={},et={},ue={INDEXEDDB:_t,WEBSQL:Pt,LOCALSTORAGE:Qt},qt=[ue.INDEXEDDB._driver,ue.WEBSQL._driver,ue.LOCALSTORAGE._driver],be=["dropInstance"],Ce=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(be),Zt={description:"",driver:qt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function er(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function Be(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(Ze(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var tr=function(){function e(r){x(this,e);for(var t in ue)if(ue.hasOwnProperty(t)){var o=ue[t],a=o._driver;this[t]=a,fe[a]||this.defineDriver(o)}this._defaultConfig=Be({},Zt),this._config=Be({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":S(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in t){if(o==="storeName"&&(t[o]=t[o].replace(/\W/g,"_")),o==="version"&&typeof t[o]!="number")return new Error("Database version must be a number.");this._config[o]=t[o]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,o,a){var n=new m(function(i,u){try{var c=t._driver,f=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){u(f);return}for(var l=Ce.concat("_initStorage"),p=0,_=l.length;p<_;p++){var R=l[p],D=!Jt(be,R);if((D||t[R])&&typeof t[R]!="function"){u(f);return}}var $=function(){for(var le=function(or){return function(){var ar=new Error("Method "+or+" is not implemented by the current driver"),tt=m.reject(ar);return g(tt,arguments[arguments.length-1]),tt}},Le=0,nr=be.length;Le<nr;Le++){var Oe=be[Le];t[Oe]||(t[Oe]=le(Oe))}};$();var M=function(le){fe[c]&&console.info("Redefining LocalForage driver: "+c),fe[c]=t,et[c]=le,i()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(M,u):M(!!t._support):M(!0)}catch(H){u(H)}});return O(n,o,a),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,o,a){var n=fe[t]?m.resolve(fe[t]):m.reject(new Error("Driver not found."));return O(n,o,a),n},e.prototype.getSerializer=function(t){var o=m.resolve(Ne);return O(o,t),o},e.prototype.ready=function(t){var o=this,a=o._driverSet.then(function(){return o._ready===null&&(o._ready=o._initDriver()),o._ready});return O(a,t,t),a},e.prototype.setDriver=function(t,o,a){var n=this;Ze(t)||(t=[t]);var i=this._getSupportedDrivers(t);function u(){n._config.driver=n.driver()}function c(p){return n._extend(p),u(),n._ready=n._initStorage(n._config),n._ready}function f(p){return function(){var _=0;function R(){for(;_<p.length;){var D=p[_];return _++,n._dbInfo=null,n._ready=null,n.getDriver(D).then(c).catch(R)}u();var $=new Error("No available storage method found.");return n._driverSet=m.reject($),n._driverSet}return R()}}var l=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=l.then(function(){var p=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(p).then(function(_){n._driver=_._driver,u(),n._wrapLibraryMethodsWithReady(),n._initDriver=f(i)})}).catch(function(){u();var p=new Error("No available storage method found.");return n._driverSet=m.reject(p),n._driverSet}),O(this._driverSet,o,a),this._driverSet},e.prototype.supports=function(t){return!!et[t]},e.prototype._extend=function(t){Be(this,t)},e.prototype._getSupportedDrivers=function(t){for(var o=[],a=0,n=t.length;a<n;a++){var i=t[a];this.supports(i)&&o.push(i)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,o=Ce.length;t<o;t++)er(this,Ce[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),rr=new tr;w.exports=rr},{3:3}]},{},[4])(4)})}(Ue)),Ue.exports}var Ir=wr();const Re=ir(Ir);async function ct(b){return new Promise((C,z)=>{const w=new FileReader;w.onload=y=>{var S;(S=y.target)!=null&&S.result?C(y.target.result):z(new Error("Failed to read blob data"))},w.onerror=()=>{z(w.error||new Error("Unknown error occurred"))},w.readAsDataURL(b)})}function Er(b,C,z,w){const y=new FormData;return y.append("name_token",b),y.append("zone_id",C),y.append("file",z),y.append("labels",w),pr({url:"/api/upload",method:"post",data:y,headers:{"Content-Type":"multipart/form-data"}})}const Sr={class:"take-photos-view"},Rr={id:"video",playsinline:"",autoplay:""},Dr={class:"imgdrawer-box"},xr=["src"],Tr={class:"img-info"},Ar={class:"location blur-background"},Nr={class:"time blur-background"},Cr={style:{gap:"2px","margin-top":"1em",display:"flex","flex-wrap":"wrap"}},Br={class:"grid-container"},Lr=["onClick"],Or={class:"image-wrapper"},Pr=["src"],Ur=ur({__name:"TakePhotosView",setup(b){function C(){if(A.value){const s=L.value.findIndex(d=>d.value===A.value.value);s!==-1&&(s===L.value.length-1?A.value=L.value[0]:A.value=L.value[s+1])}}const z=te(null),w=te(!1),y=te(null),S=Re.createInstance({driver:Re.INDEXEDDB,name:"image-storage",storeName:"images"});Re.setDriver(Re.INDEXEDDB);const x=te([]);S.iterate((s,d,h)=>{console.log(s,d,h),s&&x.value.push(s)});const E=te([]);sr(async()=>{const s=await mr();E.value=s});const N=cr(),A=te(),L=te([]);function m(){navigator.mediaDevices.enumerateDevices().then(O).catch(P)}m(),fr(A,(s,d)=>{if(s){const h=document.getElementById("video");if(h&&h.srcObject){const I=h.srcObject.getTracks();for(let T=0;T!==I.length;++T)I[T].stop()}navigator.mediaDevices.getUserMedia({video:{deviceId:s.deviceInfo.deviceId}}).then(function(I){const T=document.getElementById("video");T.srcObject=I}).catch(P)}});function g(s){w.value=!0,E.value.forEach(d=>{var h;d.checked=((h=s==null?void 0:s.labels)==null?void 0:h.includes(d.label))||!1}),s!=null&&s.labels?(s.labels=E.value.filter(d=>d.checked).map(d=>d.label),S.setItem(s.id.toString(),Ee(s)).then(()=>{y.value=Ee(s),w.value=!0}).catch(d=>{console.error(d)})):s.labels=[]}function O(s){for(let d=0;d!==s.length;++d){const h=s[d];h.kind==="videoinput"&&h.label.includes("back")&&L.value.push({label:h.label||`camera ${L.value.length+1}`,value:h.deviceId,deviceInfo:h})}if(A.value&&A.value.length===0)for(let d=0;d!==s.length;++d){const h=s[d];h.kind==="videoinput"&&L.value.push({label:h.label||`camera ${L.value.length+1}`,value:h.deviceId,deviceInfo:h})}console.log(L.value),A.value=L.value[0]}function P(s){console.log("navigator.MediaDevices.getUserMedia error: ",s.message,s.name)}function j(){var d;if(w.value){w.value=!1,A.value=null;return}const s=document.getElementById("video");if(s&&s.srcObject){const h=(d=s==null?void 0:s.srcObject)==null?void 0:d.getVideoTracks()[0];if(h){let I=new ImageCapture(h);const T=ut();I.takePhoto().then(async B=>{const U=await ct(B),F={id:T,dataUrl:U,gps:{accuracy:N.gps.accuracy,coords:{latitude:N.gps.coords.latitude,longitude:N.gps.coords.longitude},timestamp:N.gps.timestamp},shotTime:Date.now(),labels:[]};S.setItem(F.id.toString(),F).then(()=>{console.log("Image stored successfully"),X({message:"mage stored successfully",type:"success"}),x.value.push(F),y.value=F,w.value=!0}).catch(G=>{X({message:"Error storing image:"+G.message,type:"error"})})}).catch(B=>{console.error("takePhoto() error: ",B)})}}}function k(){console.log(y.value),y.value&&S.removeItem(y.value.id.toString()).then(()=>{console.log("Image removed successfully");const s=x.value.findIndex(d=>{var h;return d.id===((h=y.value)==null?void 0:h.id)});s!==-1&&x.value.splice(s,1),X({message:"Image removed successfully",type:"success"}),w.value=!1}).catch(s=>{X.error("Error removing image:",s)}).finally(()=>{w.value=!1})}const Q=vr(),Y=async s=>{if(s.raw){const d=ut(),h={id:d,dataUrl:await ct(s.raw),gps:{accuracy:N.gps.accuracy,coords:{latitude:N.gps.coords.latitude,longitude:N.gps.coords.longitude},timestamp:N.gps.timestamp},shotTime:Date.now()};S.setItem(d,h),x.value.push(h),y.value=h,w.value=!0}},se=te(null),J=async()=>{if(x.value.length===0){X.warning("没有待上传的图片");return}try{for(const s of x.value){const h=await(await fetch(s.dataUrl)).blob(),I=new File([h],`photo_${s.shotTime}.jpg`,{type:"image/jpeg"}),T=(s.labels||[]).join(","),B=localStorage.getItem("name_token")||"";if(B===""){X.warning("获取name_token失败，请从邀请链接访问。");return}const U=Q.currentRoute.value.params.zoneId;try{await Er(B,U,I,T),await S.removeItem(s.id.toString());const F=x.value.findIndex(G=>G.id===s.id);F!==-1&&x.value.splice(F,1),X.success("上传成功")}catch(F){X.error(`上传失败: ${F.message}`)}}w.value=!1}catch(s){X.error(`上传过程出错: ${s.message}`)}},v=async(s,d)=>{if(s.checked=d,s=Ee(s),!!s&&y.value){y.value.labels=E.value.filter(h=>h.checked).map(h=>h.label);try{const h=y.value.id.toString(),I=Ee(y.value);await S.setItem(h,I);const T=x.value.findIndex(B=>{var U;return B.id===((U=y.value)==null?void 0:U.id)});T!==-1&&(x.value[T]=y.value)}catch(h){console.log(h),X.error("标签更新失败: "+h)}}};return(s,d)=>{var U,F,G,ne,ae,q,ce,pe,ge;const h=Ie("el-check-tag"),I=Ie("el-button"),T=Ie("el-popconfirm"),B=Ie("el-upload");return me(),de("div",Sr,[rt(K("video",Rr,null,512),[[nt,!w.value]]),rt(K("div",Dr,[K("img",{class:"imgdrawer",ref_key:"imgdrawer",ref:z,src:(U=y.value)==null?void 0:U.dataUrl,alt:""},null,8,xr),K("div",Tr,[K("div",Ar,[K("div",null,"纬度:"+ve((ne=(G=(F=y.value)==null?void 0:F.gps)==null?void 0:G.coords)==null?void 0:ne.latitude),1),K("div",null,"经度:"+ve((ce=(q=(ae=y.value)==null?void 0:ae.gps)==null?void 0:q.coords)==null?void 0:ce.longitude),1)]),K("div",Nr,"GPS Time:"+ve((ge=(pe=y.value)==null?void 0:pe.gps)==null?void 0:ge.timestamp),1),K("div",Cr,[(me(!0),de(ot,null,at(E.value,(V,ie)=>(me(),de("div",{key:ie},[re(h,{checked:V.checked,onChange:ye=>{v(V,ye)}},{default:oe(()=>[he(ve(V.checked?"✅":"")+" "+ve(V.label),1)]),_:2},1032,["checked","onChange"])]))),128))]),re(T,{title:"确认删除?",onConfirm:k},{reference:oe(()=>[re(I,{class:"delete-item",type:"danger"},{default:oe(()=>d[0]||(d[0]=[he("删除")])),_:1})]),_:1})])],512),[[nt,w.value]]),re(I,{class:"camera-select",icon:lr(dr),circle:"",onClick:C},null,8,["icon"]),re(I,{class:"shot-btn",type:"danger",onClick:j},{default:oe(()=>d[1]||(d[1]=[he(" 拍照 ")])),_:1}),re(I,{class:"upload-btn",type:"success",onClick:J},{default:oe(()=>d[2]||(d[2]=[he(" 上传 ")])),_:1}),re(B,{ref_key:"upload",ref:se,"show-file-list":!1,class:"select-from-phone-btn",accept:"image/jpeg, image/png, image/gif, image/*",action:"",limit:1,onChange:Y,"auto-upload":!1},{trigger:oe(()=>[re(I,{type:"primary"},{default:oe(()=>d[3]||(d[3]=[he("从手机中选择")])),_:1})]),_:1},512),d[4]||(d[4]=K("p",{style:{"padding-left":"8px"}},"待上传列表: ",-1)),K("div",Br,[(me(!0),de(ot,null,at(x.value,(V,ie)=>(me(),de("div",{key:ie,class:"grid-item",onClick:ye=>g(V)},[K("div",Or,[K("img",{src:V.dataUrl,alt:"photo",class:"square-image"},null,8,Pr)])],8,Lr))),128))])])}}}),$r=hr(Ur,[["__scopeId","data-v-7094409b"]]);export{$r as default};
