import{q as xe,s as cn,v as ln,d as fn,x as ae,o as lt,y as dn,w as vn,k as ue,i as U,z as ft,g as k,A as dt,u as de,B as hn,C as he,t as ce,a as Q,F as ze,l as Ye,D as mn,G as Z,H as gn,p as me,I as pn,J as yn,K as _n,L as bn,M as wn,e as In,f as le,N as Ae,_ as En}from"./index-D8SYNlsh.js";import{g as Sn}from"./label-CmwT2Tjh.js";const G=[];for(let E=0;E<256;++E)G.push((E+256).toString(16).slice(1));function Dn(E,B=0){return(G[E[B+0]]+G[E[B+1]]+G[E[B+2]]+G[E[B+3]]+"-"+G[E[B+4]]+G[E[B+5]]+"-"+G[E[B+6]]+G[E[B+7]]+"-"+G[E[B+8]]+G[E[B+9]]+"-"+G[E[B+10]]+G[E[B+11]]+G[E[B+12]]+G[E[B+13]]+G[E[B+14]]+G[E[B+15]]).toLowerCase()}let We;const Rn=new Uint8Array(16);function Cn(){if(!We){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");We=crypto.getRandomValues.bind(crypto)}return We(Rn)}const xn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vt={randomUUID:xn};function ht(E,B,H){var S;if(vt.randomUUID&&!E)return vt.randomUUID();E=E||{};const A=E.random??((S=E.rng)==null?void 0:S.call(E))??Cn();if(A.length<16)throw new Error("Random bytes length must be >= 16");return A[6]=A[6]&15|64,A[8]=A[8]&63|128,Dn(A)}function Te(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ve={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var mt;function An(){return mt||(mt=1,function(E,B){(function(H){E.exports=H()})(function(){return function H(A,S,_){function P(T,W){if(!S[T]){if(!A[T]){var v=typeof Te=="function"&&Te;if(!W&&v)return v(T,!0);if(p)return p(T,!0);var y=new Error("Cannot find module '"+T+"'");throw y.code="MODULE_NOT_FOUND",y}var O=S[T]={exports:{}};A[T][0].call(O.exports,function(M){var X=A[T][1][M];return P(X||M)},O,O.exports,H,A,S,_)}return S[T].exports}for(var p=typeof Te=="function"&&Te,F=0;F<_.length;F++)P(_[F]);return P}({1:[function(H,A,S){(function(_){var P=_.MutationObserver||_.WebKitMutationObserver,p;if(P){var F=0,T=new P(M),W=_.document.createTextNode("");T.observe(W,{characterData:!0}),p=function(){W.data=F=++F%2}}else if(!_.setImmediate&&typeof _.MessageChannel<"u"){var v=new _.MessageChannel;v.port1.onmessage=M,p=function(){v.port2.postMessage(0)}}else"document"in _&&"onreadystatechange"in _.document.createElement("script")?p=function(){var $=_.document.createElement("script");$.onreadystatechange=function(){M(),$.onreadystatechange=null,$.parentNode.removeChild($),$=null},_.document.documentElement.appendChild($)}:p=function(){setTimeout(M,0)};var y,O=[];function M(){y=!0;for(var $,ne,V=O.length;V;){for(ne=O,O=[],$=-1;++$<V;)ne[$]();V=O.length}y=!1}A.exports=X;function X($){O.push($)===1&&!y&&p()}}).call(this,typeof xe<"u"?xe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(H,A,S){var _=H(1);function P(){}var p={},F=["REJECTED"],T=["FULFILLED"],W=["PENDING"];A.exports=v;function v(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=W,this.queue=[],this.outcome=void 0,f!==P&&X(this,f)}v.prototype.catch=function(f){return this.then(null,f)},v.prototype.then=function(f,D){if(typeof f!="function"&&this.state===T||typeof D!="function"&&this.state===F)return this;var w=new this.constructor(P);if(this.state!==W){var R=this.state===T?f:D;O(w,R,this.outcome)}else this.queue.push(new y(w,f,D));return w};function y(f,D,w){this.promise=f,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}y.prototype.callFulfilled=function(f){p.resolve(this.promise,f)},y.prototype.otherCallFulfilled=function(f){O(this.promise,this.onFulfilled,f)},y.prototype.callRejected=function(f){p.reject(this.promise,f)},y.prototype.otherCallRejected=function(f){O(this.promise,this.onRejected,f)};function O(f,D,w){_(function(){var R;try{R=D(w)}catch(u){return p.reject(f,u)}R===f?p.reject(f,new TypeError("Cannot resolve promise with itself")):p.resolve(f,R)})}p.resolve=function(f,D){var w=$(M,D);if(w.status==="error")return p.reject(f,w.value);var R=w.value;if(R)X(f,R);else{f.state=T,f.outcome=D;for(var u=-1,g=f.queue.length;++u<g;)f.queue[u].callFulfilled(D)}return f},p.reject=function(f,D){f.state=F,f.outcome=D;for(var w=-1,R=f.queue.length;++w<R;)f.queue[w].callRejected(D);return f};function M(f){var D=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof D=="function")return function(){D.apply(f,arguments)}}function X(f,D){var w=!1;function R(b){w||(w=!0,p.reject(f,b))}function u(b){w||(w=!0,p.resolve(f,b))}function g(){D(u,R)}var h=$(g);h.status==="error"&&R(h.value)}function $(f,D){var w={};try{w.value=f(D),w.status="success"}catch(R){w.status="error",w.value=R}return w}v.resolve=ne;function ne(f){return f instanceof this?f:p.resolve(new this(P),f)}v.reject=V;function V(f){var D=new this(P);return p.reject(D,f)}v.all=ge;function ge(f){var D=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=f.length,R=!1;if(!w)return this.resolve([]);for(var u=new Array(w),g=0,h=-1,b=new this(P);++h<w;)N(f[h],h);return b;function N(J,L){D.resolve(J).then(K,function(z){R||(R=!0,p.reject(b,z))});function K(z){u[L]=z,++g===w&&!R&&(R=!0,p.resolve(b,u))}}}v.race=re;function re(f){var D=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=f.length,R=!1;if(!w)return this.resolve([]);for(var u=-1,g=new this(P);++u<w;)h(f[u]);return g;function h(b){D.resolve(b).then(function(N){R||(R=!0,p.resolve(g,N))},function(N){R||(R=!0,p.reject(g,N))})}}},{1:1}],3:[function(H,A,S){(function(_){typeof _.Promise!="function"&&(_.Promise=H(2))}).call(this,typeof xe<"u"?xe:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(H,A,S){var _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function P(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function p(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var F=p();function T(){try{if(!F||!F.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||n)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function W(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(r){if(r.name!=="TypeError")throw r;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new t,a=0;a<e.length;a+=1)o.append(e[a]);return o.getBlob(n.type)}}typeof Promise>"u"&&H(3);var v=Promise;function y(e,n){n&&e.then(function(t){n(null,t)},function(t){n(t)})}function O(e,n,t){typeof n=="function"&&e.then(n),typeof t=="function"&&e.catch(t)}function M(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function X(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var $="local-forage-detect-blob-support",ne=void 0,V={},ge=Object.prototype.toString,re="readonly",f="readwrite";function D(e){for(var n=e.length,t=new ArrayBuffer(n),o=new Uint8Array(t),a=0;a<n;a++)o[a]=e.charCodeAt(a);return t}function w(e){return new v(function(n){var t=e.transaction($,f),o=W([""]);t.objectStore($).put(o,"key"),t.onabort=function(a){a.preventDefault(),a.stopPropagation(),n(!1)},t.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);n(r||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function R(e){return typeof ne=="boolean"?v.resolve(ne):w(e).then(function(n){return ne=n,ne})}function u(e){var n=V[e.name],t={};t.promise=new v(function(o,a){t.resolve=o,t.reject=a}),n.deferredOperations.push(t),n.dbReady?n.dbReady=n.dbReady.then(function(){return t.promise}):n.dbReady=t.promise}function g(e){var n=V[e.name],t=n.deferredOperations.pop();if(t)return t.resolve(),t.promise}function h(e,n){var t=V[e.name],o=t.deferredOperations.pop();if(o)return o.reject(n),o.promise}function b(e,n){return new v(function(t,o){if(V[e.name]=V[e.name]||pe(),e.db)if(n)u(e),e.db.close();else return t(e.db);var a=[e.name];n&&a.push(e.version);var r=F.open.apply(F,a);n&&(r.onupgradeneeded=function(i){var s=r.result;try{s.createObjectStore(e.storeName),i.oldVersion<=1&&s.createObjectStore($)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),r.onerror=function(i){i.preventDefault(),o(r.error)},r.onsuccess=function(){var i=r.result;i.onversionchange=function(s){s.target.close()},t(i),g(e)}})}function N(e){return b(e,!1)}function J(e){return b(e,!0)}function L(e,n){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,a=e.version>e.db.version;if(o&&(e.version!==n&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||t){if(t){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function K(e){return new v(function(n,t){var o=new FileReader;o.onerror=t,o.onloadend=function(a){var r=btoa(a.target.result||"");n({__local_forage_encoded_blob:!0,data:r,type:e.type})},o.readAsBinaryString(e)})}function z(e){var n=D(atob(e.data));return W([n],{type:e.type})}function oe(e){return e&&e.__local_forage_encoded_blob}function we(e){var n=this,t=n._initReady().then(function(){var o=V[n._dbInfo.name];if(o&&o.dbReady)return o.dbReady});return O(t,e,e),t}function Ie(e){u(e);for(var n=V[e.name],t=n.forages,o=0;o<t.length;o++){var a=t[o];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,N(e).then(function(r){return e.db=r,L(e)?J(e):r}).then(function(r){e.db=n.db=r;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=r}).catch(function(r){throw h(e,r),r})}function ee(e,n,t,o){o===void 0&&(o=1);try{var a=e.db.transaction(e.storeName,n);t(null,a)}catch(r){if(o>0&&(!e.db||r.name==="InvalidStateError"||r.name==="NotFoundError"))return v.resolve().then(function(){if(!e.db||r.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),J(e)}).then(function(){return Ie(e).then(function(){ee(e,n,t,o-1)})}).catch(t);t(r)}}function pe(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ee(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=e[o];var a=V[t.name];a||(a=pe(),V[t.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=we);var r=[];function i(){return v.resolve()}for(var s=0;s<a.forages.length;s++){var c=a.forages[s];c!==n&&r.push(c._initReady().catch(i))}var l=a.forages.slice(0);return v.all(r).then(function(){return t.db=a.db,N(t)}).then(function(d){return t.db=d,L(t,n._defaultConfig.version)?J(t):d}).then(function(d){t.db=a.db=d,n._dbInfo=t;for(var m=0;m<l.length;m++){var I=l[m];I!==n&&(I._dbInfo.db=t.db,I._dbInfo.version=t.version)}})}function Se(e,n){var t=this;e=M(e);var o=new v(function(a,r){t.ready().then(function(){ee(t._dbInfo,re,function(i,s){if(i)return r(i);try{var c=s.objectStore(t._dbInfo.storeName),l=c.get(e);l.onsuccess=function(){var d=l.result;d===void 0&&(d=null),oe(d)&&(d=z(d)),a(d)},l.onerror=function(){r(l.error)}}catch(d){r(d)}})}).catch(r)});return y(o,n),o}function De(e,n){var t=this,o=new v(function(a,r){t.ready().then(function(){ee(t._dbInfo,re,function(i,s){if(i)return r(i);try{var c=s.objectStore(t._dbInfo.storeName),l=c.openCursor(),d=1;l.onsuccess=function(){var m=l.result;if(m){var I=m.value;oe(I)&&(I=z(I));var C=e(I,m.key,d++);C!==void 0?a(C):m.continue()}else a()},l.onerror=function(){r(l.error)}}catch(m){r(m)}})}).catch(r)});return y(o,n),o}function q(e,n,t){var o=this;e=M(e);var a=new v(function(r,i){var s;o.ready().then(function(){return s=o._dbInfo,ge.call(n)==="[object Blob]"?R(s.db).then(function(c){return c?n:K(n)}):n}).then(function(c){ee(o._dbInfo,f,function(l,d){if(l)return i(l);try{var m=d.objectStore(o._dbInfo.storeName);c===null&&(c=void 0);var I=m.put(c,e);d.oncomplete=function(){c===void 0&&(c=null),r(c)},d.onabort=d.onerror=function(){var C=I.error?I.error:I.transaction.error;i(C)}}catch(C){i(C)}})}).catch(i)});return y(a,t),a}function fe(e,n){var t=this;e=M(e);var o=new v(function(a,r){t.ready().then(function(){ee(t._dbInfo,f,function(i,s){if(i)return r(i);try{var c=s.objectStore(t._dbInfo.storeName),l=c.delete(e);s.oncomplete=function(){a()},s.onerror=function(){r(l.error)},s.onabort=function(){var d=l.error?l.error:l.transaction.error;r(d)}}catch(d){r(d)}})}).catch(r)});return y(o,n),o}function ye(e){var n=this,t=new v(function(o,a){n.ready().then(function(){ee(n._dbInfo,f,function(r,i){if(r)return a(r);try{var s=i.objectStore(n._dbInfo.storeName),c=s.clear();i.oncomplete=function(){o()},i.onabort=i.onerror=function(){var l=c.error?c.error:c.transaction.error;a(l)}}catch(l){a(l)}})}).catch(a)});return y(t,e),t}function pt(e){var n=this,t=new v(function(o,a){n.ready().then(function(){ee(n._dbInfo,re,function(r,i){if(r)return a(r);try{var s=i.objectStore(n._dbInfo.storeName),c=s.count();c.onsuccess=function(){o(c.result)},c.onerror=function(){a(c.error)}}catch(l){a(l)}})}).catch(a)});return y(t,e),t}function yt(e,n){var t=this,o=new v(function(a,r){if(e<0){a(null);return}t.ready().then(function(){ee(t._dbInfo,re,function(i,s){if(i)return r(i);try{var c=s.objectStore(t._dbInfo.storeName),l=!1,d=c.openKeyCursor();d.onsuccess=function(){var m=d.result;if(!m){a(null);return}e===0||l?a(m.key):(l=!0,m.advance(e))},d.onerror=function(){r(d.error)}}catch(m){r(m)}})}).catch(r)});return y(o,n),o}function _t(e){var n=this,t=new v(function(o,a){n.ready().then(function(){ee(n._dbInfo,re,function(r,i){if(r)return a(r);try{var s=i.objectStore(n._dbInfo.storeName),c=s.openKeyCursor(),l=[];c.onsuccess=function(){var d=c.result;if(!d){o(l);return}l.push(d.key),d.continue()},c.onerror=function(){a(c.error)}}catch(d){a(d)}})}).catch(a)});return y(t,e),t}function bt(e,n){n=X.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,a;if(!e.name)a=v.reject("Invalid arguments");else{var r=e.name===t.name&&o._dbInfo.db,i=r?v.resolve(o._dbInfo.db):N(e).then(function(s){var c=V[e.name],l=c.forages;c.db=s;for(var d=0;d<l.length;d++)l[d]._dbInfo.db=s;return s});e.storeName?a=i.then(function(s){if(s.objectStoreNames.contains(e.storeName)){var c=s.version+1;u(e);var l=V[e.name],d=l.forages;s.close();for(var m=0;m<d.length;m++){var I=d[m];I._dbInfo.db=null,I._dbInfo.version=c}var C=new v(function(x,j){var Y=F.open(e.name,c);Y.onerror=function(te){var be=Y.result;be.close(),j(te)},Y.onupgradeneeded=function(){var te=Y.result;te.deleteObjectStore(e.storeName)},Y.onsuccess=function(){var te=Y.result;te.close(),x(te)}});return C.then(function(x){l.db=x;for(var j=0;j<d.length;j++){var Y=d[j];Y._dbInfo.db=x,g(Y._dbInfo)}}).catch(function(x){throw(h(e,x)||v.resolve()).catch(function(){}),x})}}):a=i.then(function(s){u(e);var c=V[e.name],l=c.forages;s.close();for(var d=0;d<l.length;d++){var m=l[d];m._dbInfo.db=null}var I=new v(function(C,x){var j=F.deleteDatabase(e.name);j.onerror=function(){var Y=j.result;Y&&Y.close(),x(j.error)},j.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},j.onsuccess=function(){var Y=j.result;Y&&Y.close(),C(Y)}});return I.then(function(C){c.db=C;for(var x=0;x<l.length;x++){var j=l[x];g(j._dbInfo)}}).catch(function(C){throw(h(e,C)||v.resolve()).catch(function(){}),C})})}return y(a,n),a}var wt={_driver:"asyncStorage",_initStorage:Ee,_support:T(),iterate:De,getItem:Se,setItem:q,removeItem:fe,clear:ye,length:pt,key:yt,keys:_t,dropInstance:bt};function It(){return typeof openDatabase=="function"}var ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Et="~~local_forage_type~",je=/^~~local_forage_type~([^~]+)~/,Re="__lfsc__:",Be=Re.length,Le="arbf",Pe="blob",He="si08",Ge="ui08",Ke="uic8",Qe="si16",Xe="si32",Je="ur16",qe="ui32",Ze="fl32",et="fl64",tt=Be+Le.length,nt=Object.prototype.toString;function rt(e){var n=e.length*.75,t=e.length,o,a=0,r,i,s,c;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);var l=new ArrayBuffer(n),d=new Uint8Array(l);for(o=0;o<t;o+=4)r=ie.indexOf(e[o]),i=ie.indexOf(e[o+1]),s=ie.indexOf(e[o+2]),c=ie.indexOf(e[o+3]),d[a++]=r<<2|i>>4,d[a++]=(i&15)<<4|s>>2,d[a++]=(s&3)<<6|c&63;return l}function Oe(e){var n=new Uint8Array(e),t="",o;for(o=0;o<n.length;o+=3)t+=ie[n[o]>>2],t+=ie[(n[o]&3)<<4|n[o+1]>>4],t+=ie[(n[o+1]&15)<<2|n[o+2]>>6],t+=ie[n[o+2]&63];return n.length%3===2?t=t.substring(0,t.length-1)+"=":n.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function St(e,n){var t="";if(e&&(t=nt.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&nt.call(e.buffer)==="[object ArrayBuffer]")){var o,a=Re;e instanceof ArrayBuffer?(o=e,a+=Le):(o=e.buffer,t==="[object Int8Array]"?a+=He:t==="[object Uint8Array]"?a+=Ge:t==="[object Uint8ClampedArray]"?a+=Ke:t==="[object Int16Array]"?a+=Qe:t==="[object Uint16Array]"?a+=Je:t==="[object Int32Array]"?a+=Xe:t==="[object Uint32Array]"?a+=qe:t==="[object Float32Array]"?a+=Ze:t==="[object Float64Array]"?a+=et:n(new Error("Failed to get type for BinaryArray"))),n(a+Oe(o))}else if(t==="[object Blob]"){var r=new FileReader;r.onload=function(){var i=Et+e.type+"~"+Oe(this.result);n(Re+Pe+i)},r.readAsArrayBuffer(e)}else try{n(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),n(null,i)}}function Dt(e){if(e.substring(0,Be)!==Re)return JSON.parse(e);var n=e.substring(tt),t=e.substring(Be,tt),o;if(t===Pe&&je.test(n)){var a=n.match(je);o=a[1],n=n.substring(a[0].length)}var r=rt(n);switch(t){case Le:return r;case Pe:return W([r],{type:o});case He:return new Int8Array(r);case Ge:return new Uint8Array(r);case Ke:return new Uint8ClampedArray(r);case Qe:return new Int16Array(r);case Je:return new Uint16Array(r);case Xe:return new Int32Array(r);case qe:return new Uint32Array(r);case Ze:return new Float32Array(r);case et:return new Float64Array(r);default:throw new Error("Unkown type: "+t)}}var Ue={serialize:St,deserialize:Dt,stringToBuffer:rt,bufferToString:Oe};function ot(e,n,t,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,o)}function Rt(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=typeof e[o]!="string"?e[o].toString():e[o];var a=new v(function(r,i){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(s){return i(s)}t.db.transaction(function(s){ot(s,t,function(){n._dbInfo=t,r()},function(c,l){i(l)})},i)});return t.serializer=Ue,a}function se(e,n,t,o,a,r){e.executeSql(t,o,a,function(i,s){s.code===s.SYNTAX_ERR?i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],function(c,l){l.rows.length?r(c,s):ot(c,n,function(){c.executeSql(t,o,a,r)},r)},r):r(i,s)},r)}function Ct(e,n){var t=this;e=M(e);var o=new v(function(a,r){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){se(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(c,l){var d=l.rows.length?l.rows.item(0).value:null;d&&(d=i.serializer.deserialize(d)),a(d)},function(c,l){r(l)})})}).catch(r)});return y(o,n),o}function xt(e,n){var t=this,o=new v(function(a,r){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){se(s,i,"SELECT * FROM "+i.storeName,[],function(c,l){for(var d=l.rows,m=d.length,I=0;I<m;I++){var C=d.item(I),x=C.value;if(x&&(x=i.serializer.deserialize(x)),x=e(x,C.key,I+1),x!==void 0){a(x);return}}a()},function(c,l){r(l)})})}).catch(r)});return y(o,n),o}function at(e,n,t,o){var a=this;e=M(e);var r=new v(function(i,s){a.ready().then(function(){n===void 0&&(n=null);var c=n,l=a._dbInfo;l.serializer.serialize(n,function(d,m){m?s(m):l.db.transaction(function(I){se(I,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,d],function(){i(c)},function(C,x){s(x)})},function(I){if(I.code===I.QUOTA_ERR){if(o>0){i(at.apply(a,[e,c,t,o-1]));return}s(I)}})})}).catch(s)});return y(r,t),r}function At(e,n,t){return at.apply(this,[e,n,t,1])}function Tt(e,n){var t=this;e=M(e);var o=new v(function(a,r){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){se(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){a()},function(c,l){r(l)})})}).catch(r)});return y(o,n),o}function Nt(e){var n=this,t=new v(function(o,a){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(i){se(i,r,"DELETE FROM "+r.storeName,[],function(){o()},function(s,c){a(c)})})}).catch(a)});return y(t,e),t}function Bt(e){var n=this,t=new v(function(o,a){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(i){se(i,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],function(s,c){var l=c.rows.item(0).c;o(l)},function(s,c){a(c)})})}).catch(a)});return y(t,e),t}function Lt(e,n){var t=this,o=new v(function(a,r){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){se(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,l){var d=l.rows.length?l.rows.item(0).key:null;a(d)},function(c,l){r(l)})})}).catch(r)});return y(o,n),o}function Pt(e){var n=this,t=new v(function(o,a){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(i){se(i,r,"SELECT key FROM "+r.storeName,[],function(s,c){for(var l=[],d=0;d<c.rows.length;d++)l.push(c.rows.item(d).key);o(l)},function(s,c){a(c)})})}).catch(a)});return y(t,e),t}function Ot(e){return new v(function(n,t){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(a,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);n({db:e,storeNames:i})},function(a,r){t(r)})},function(o){t(o)})})}function Ut(e,n){n=X.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,a;return e.name?a=new v(function(r){var i;e.name===t.name?i=o._dbInfo.db:i=openDatabase(e.name,"","",0),e.storeName?r({db:i,storeNames:[e.storeName]}):r(Ot(i))}).then(function(r){return new v(function(i,s){r.db.transaction(function(c){function l(C){return new v(function(x,j){c.executeSql("DROP TABLE IF EXISTS "+C,[],function(){x()},function(Y,te){j(te)})})}for(var d=[],m=0,I=r.storeNames.length;m<I;m++)d.push(l(r.storeNames[m]));v.all(d).then(function(){i()}).catch(function(C){s(C)})},function(c){s(c)})})}):a=v.reject("Invalid arguments"),y(a,n),a}var kt={_driver:"webSQLStorage",_initStorage:Rt,_support:It(),iterate:xt,getItem:Ct,setItem:At,removeItem:Tt,clear:Nt,length:Bt,key:Lt,keys:Pt,dropInstance:Ut};function Ft(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function it(e,n){var t=e.name+"/";return e.storeName!==n.storeName&&(t+=e.storeName+"/"),t}function Mt(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function $t(){return!Mt()||localStorage.length>0}function zt(e){var n=this,t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=it(e,n._defaultConfig),$t()?(n._dbInfo=t,t.serializer=Ue,v.resolve()):v.reject()}function Yt(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo.keyPrefix,a=localStorage.length-1;a>=0;a--){var r=localStorage.key(a);r.indexOf(o)===0&&localStorage.removeItem(r)}});return y(t,e),t}function Wt(e,n){var t=this;e=M(e);var o=t.ready().then(function(){var a=t._dbInfo,r=localStorage.getItem(a.keyPrefix+e);return r&&(r=a.serializer.deserialize(r)),r});return y(o,n),o}function Vt(e,n){var t=this,o=t.ready().then(function(){for(var a=t._dbInfo,r=a.keyPrefix,i=r.length,s=localStorage.length,c=1,l=0;l<s;l++){var d=localStorage.key(l);if(d.indexOf(r)===0){var m=localStorage.getItem(d);if(m&&(m=a.serializer.deserialize(m)),m=e(m,d.substring(i),c++),m!==void 0)return m}}});return y(o,n),o}function jt(e,n){var t=this,o=t.ready().then(function(){var a=t._dbInfo,r;try{r=localStorage.key(e)}catch{r=null}return r&&(r=r.substring(a.keyPrefix.length)),r});return y(o,n),o}function Ht(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo,a=localStorage.length,r=[],i=0;i<a;i++){var s=localStorage.key(i);s.indexOf(o.keyPrefix)===0&&r.push(s.substring(o.keyPrefix.length))}return r});return y(t,e),t}function Gt(e){var n=this,t=n.keys().then(function(o){return o.length});return y(t,e),t}function Kt(e,n){var t=this;e=M(e);var o=t.ready().then(function(){var a=t._dbInfo;localStorage.removeItem(a.keyPrefix+e)});return y(o,n),o}function Qt(e,n,t){var o=this;e=M(e);var a=o.ready().then(function(){n===void 0&&(n=null);var r=n;return new v(function(i,s){var c=o._dbInfo;c.serializer.serialize(n,function(l,d){if(d)s(d);else try{localStorage.setItem(c.keyPrefix+e,l),i(r)}catch(m){(m.name==="QuotaExceededError"||m.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s(m),s(m)}})})});return y(a,t),a}function Xt(e,n){if(n=X.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var o=this,a;return e.name?a=new v(function(r){e.storeName?r(it(e,o._defaultConfig)):r(e.name+"/")}).then(function(r){for(var i=localStorage.length-1;i>=0;i--){var s=localStorage.key(i);s.indexOf(r)===0&&localStorage.removeItem(s)}}):a=v.reject("Invalid arguments"),y(a,n),a}var Jt={_driver:"localStorageWrapper",_initStorage:zt,_support:Ft(),iterate:Vt,getItem:Wt,setItem:Qt,removeItem:Kt,clear:Yt,length:Gt,key:jt,keys:Ht,dropInstance:Xt},qt=function(n,t){return n===t||typeof n=="number"&&typeof t=="number"&&isNaN(n)&&isNaN(t)},Zt=function(n,t){for(var o=n.length,a=0;a<o;){if(qt(n[a],t))return!0;a++}return!1},st=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},_e={},ut={},ve={INDEXEDDB:wt,WEBSQL:kt,LOCALSTORAGE:Jt},en=[ve.INDEXEDDB._driver,ve.WEBSQL._driver,ve.LOCALSTORAGE._driver],Ce=["dropInstance"],ke=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ce),tn={description:"",driver:en.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function nn(e,n){e[n]=function(){var t=arguments;return e.ready().then(function(){return e[n].apply(e,t)})}}function Fe(){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var t in n)n.hasOwnProperty(t)&&(st(n[t])?arguments[0][t]=n[t].slice():arguments[0][t]=n[t])}return arguments[0]}var rn=function(){function e(n){P(this,e);for(var t in ve)if(ve.hasOwnProperty(t)){var o=ve[t],a=o._driver;this[t]=a,_e[a]||this.defineDriver(o)}this._defaultConfig=Fe({},tn),this._config=Fe({},this._defaultConfig,n),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":_(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in t){if(o==="storeName"&&(t[o]=t[o].replace(/\W/g,"_")),o==="version"&&typeof t[o]!="number")return new Error("Database version must be a number.");this._config[o]=t[o]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,o,a){var r=new v(function(i,s){try{var c=t._driver,l=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){s(l);return}for(var d=ke.concat("_initStorage"),m=0,I=d.length;m<I;m++){var C=d[m],x=!Zt(Ce,C);if((x||t[C])&&typeof t[C]!="function"){s(l);return}}var j=function(){for(var be=function(sn){return function(){var un=new Error("Method "+sn+" is not implemented by the current driver"),ct=v.reject(un);return y(ct,arguments[arguments.length-1]),ct}},Me=0,an=Ce.length;Me<an;Me++){var $e=Ce[Me];t[$e]||(t[$e]=be($e))}};j();var Y=function(be){_e[c]&&console.info("Redefining LocalForage driver: "+c),_e[c]=t,ut[c]=be,i()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(Y,s):Y(!!t._support):Y(!0)}catch(te){s(te)}});return O(r,o,a),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,o,a){var r=_e[t]?v.resolve(_e[t]):v.reject(new Error("Driver not found."));return O(r,o,a),r},e.prototype.getSerializer=function(t){var o=v.resolve(Ue);return O(o,t),o},e.prototype.ready=function(t){var o=this,a=o._driverSet.then(function(){return o._ready===null&&(o._ready=o._initDriver()),o._ready});return O(a,t,t),a},e.prototype.setDriver=function(t,o,a){var r=this;st(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){r._config.driver=r.driver()}function c(m){return r._extend(m),s(),r._ready=r._initStorage(r._config),r._ready}function l(m){return function(){var I=0;function C(){for(;I<m.length;){var x=m[I];return I++,r._dbInfo=null,r._ready=null,r.getDriver(x).then(c).catch(C)}s();var j=new Error("No available storage method found.");return r._driverSet=v.reject(j),r._driverSet}return C()}}var d=this._driverSet!==null?this._driverSet.catch(function(){return v.resolve()}):v.resolve();return this._driverSet=d.then(function(){var m=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(m).then(function(I){r._driver=I._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=l(i)})}).catch(function(){s();var m=new Error("No available storage method found.");return r._driverSet=v.reject(m),r._driverSet}),O(this._driverSet,o,a),this._driverSet},e.prototype.supports=function(t){return!!ut[t]},e.prototype._extend=function(t){Fe(this,t)},e.prototype._getSupportedDrivers=function(t){for(var o=[],a=0,r=t.length;a<r;a++){var i=t[a];this.supports(i)&&o.push(i)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,o=ke.length;t<o;t++)nn(this,ke[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),on=new rn;A.exports=on},{3:3}]},{},[4])(4)})}(Ve)),Ve.exports}var Tn=An();const Ne=cn(Tn);async function gt(E){return new Promise((B,H)=>{const A=new FileReader;A.onload=S=>{var _;(_=S.target)!=null&&_.result?B(S.target.result):H(new Error("Failed to read blob data"))},A.onerror=()=>{H(A.error||new Error("Unknown error occurred"))},A.readAsDataURL(E)})}function Nn(E,B,H,A){const S=new FormData;return S.append("name_token",E),S.append("zone_id",B),S.append("file",H),S.append("labels",A),ln({url:"/api/file/upload",method:"post",data:S,headers:{"Content-Type":"multipart/form-data"}})}const Bn={class:"take-photos-view"},Ln={class:"camera-container"},Pn={id:"video",playsinline:"",autoplay:""},On={class:"preview-drawer"},Un=["src"],kn={class:"preview-info"},Fn={class:"info-section"},Mn={class:"location-info blur-panel"},$n={class:"info-row"},zn={class:"info-row"},Yn={class:"time-info blur-panel"},Wn={class:"thumbnail-section blur-panel"},Vn={class:"thumbnail-header"},jn={class:"thumbnail-list"},Hn=["onClick"],Gn=["src"],Kn={class:"tags-container blur-panel"},Qn={class:"preview-action-buttons blur-panel"},Xn={class:"bottom-controls"},Jn={class:"thumbnail-section"},qn={class:"thumbnail-header"},Zn={class:"thumbnail-list"},er=["onClick"],tr=["src"],nr={class:"action-buttons"},rr={key:0,class:"upload-progress"},or=fn({__name:"TakePhotosView",setup(E){const B=u=>`${f.value.current}/${f.value.total} (${u}%)`;function H(){if(W.value){const u=v.value.findIndex(g=>g.value===W.value.value);u!==-1&&(u===v.value.length-1?W.value=v.value[0]:W.value=v.value[u+1])}}const A=ae(null),S=ae(!1),_=ae(null),P=Ne.createInstance({driver:Ne.INDEXEDDB,name:"image-storage",storeName:"images"});Ne.setDriver(Ne.INDEXEDDB);const p=ae([]);P.iterate((u,g,h)=>{console.log(u,g,h),u&&p.value.push(u)});const F=ae([]);lt(async()=>{const u=await Sn();F.value=u});const T=dn(),W=ae(),v=ae([]);async function y(){try{if(console.log("开始获取摄像头设备..."),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw console.log("mediaDevices API不可用:",{mediaDevices:!!navigator.mediaDevices,enumerateDevices:!!(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)}),new Error("浏览器不支持mediaDevices API");console.log("请求摄像头权限..."),await navigator.mediaDevices.getUserMedia({video:!0}),console.log("摄像头权限获取成功"),console.log("开始枚举设备...");const u=await navigator.mediaDevices.enumerateDevices();console.log("枚举到的所有设备:",u),M(u)}catch(u){console.error("获取摄像头失败:",u),X(u),Z.error("获取摄像头失败，请确保已授予摄像头权限")}}y(),lt(()=>{y()}),vn(W,(u,g)=>{if(u){const h=document.getElementById("video");if(h&&h.srcObject){const b=h.srcObject.getTracks();for(let N=0;N!==b.length;++N)b[N].stop()}navigator.mediaDevices.getUserMedia({video:{deviceId:u.deviceInfo.deviceId}}).then(function(b){const N=document.getElementById("video");N.srcObject=b}).catch(X)}});function O(u){S.value=!0,F.value.forEach(g=>{var h;g.checked=((h=u==null?void 0:u.labels)==null?void 0:h.includes(g.label))||!1}),u!=null&&u.labels?(u.labels=F.value.filter(g=>g.checked).map(g=>g.label),P.setItem(u.id.toString(),Ae(u)).then(()=>{_.value=Ae(u),S.value=!0}).catch(g=>{console.error(g)})):u.labels=[]}function M(u){console.log("开始处理设备列表...");for(let g=0;g!==u.length;++g){const h=u[g];console.log("检查设备:",{kind:h.kind,label:h.label,deviceId:h.deviceId}),h.kind==="videoinput"&&(h.label.toLowerCase().includes("back")||h.label.toLowerCase().includes("后置")||h.label.toLowerCase().includes("rear"))&&(console.log("找到后置摄像头:",h.label),v.value.push({label:h.label||`camera ${v.value.length+1}`,value:h.deviceId,deviceInfo:h}))}if(v.value.length===0){console.log("未找到后置摄像头，添加所有视频输入设备");for(let g=0;g!==u.length;++g){const h=u[g];h.kind==="videoinput"&&(console.log("添加视频输入设备:",h.label),v.value.push({label:h.label||`camera ${v.value.length+1}`,value:h.deviceId,deviceInfo:h}))}}console.log("最终的摄像头列表:",v.value),v.value.length>0?(W.value=v.value[0],console.log("已选择默认摄像头:",W.value)):console.log("警告: 未找到任何可用的摄像头设备")}function X(u){console.log("navigator.MediaDevices.getUserMedia error: ",u.message,u.name),console.error("摄像头错误详情:",{message:u.message,name:u.name,stack:u.stack})}function $(){var J;if(S.value){S.value=!1,W.value=null;return}const u=document.getElementById("video");if(!u||!u.srcObject){Z.error("未找到视频流");return}const g=(J=u==null?void 0:u.srcObject)==null?void 0:J.getVideoTracks()[0];if(!g){Z.error("未找到视频轨道");return}const h=ht();"ImageCapture"in window?(console.log("使用 ImageCapture API 拍照"),new ImageCapture(g).takePhoto().then(async K=>{const z=await gt(K);N(h,z)}).catch(K=>{console.error("ImageCapture takePhoto 失败，降级使用 Canvas:",K),b()})):(console.log("浏览器不支持 ImageCapture，使用 Canvas 拍照"),b());function b(){try{const L=document.createElement("canvas");L.width=u.videoWidth,L.height=u.videoHeight;const K=L.getContext("2d");if(!K)throw new Error("无法获取 canvas 上下文");K.drawImage(u,0,0,L.width,L.height);const z=L.toDataURL("image/jpeg",.8);N(h,z)}catch(L){console.error("Canvas 拍照失败:",L),Z.error("拍照失败："+L)}}function N(L,K){const z={id:L,dataUrl:K,gps:{accuracy:T.gps.accuracy,coords:{latitude:T.gps.coords.latitude,longitude:T.gps.coords.longitude},timestamp:T.gps.timestamp},shotTime:Date.now(),labels:[]};P.setItem(z.id.toString(),z).then(()=>{console.log("图片保存成功"),Z({message:"照片已保存",type:"success"}),p.value.push(z),_.value=z,S.value=!0}).catch(oe=>{Z({message:"保存照片失败:"+oe.message,type:"error"})})}}function ne(){console.log(_.value),_.value&&P.removeItem(_.value.id.toString()).then(()=>{console.log("Image removed successfully");const u=p.value.findIndex(g=>{var h;return g.id===((h=_.value)==null?void 0:h.id)});u!==-1&&p.value.splice(u,1),Z({message:"照片已删除",type:"success"}),S.value=!1}).catch(u=>{Z.error("删除照片失败:",u)}).finally(()=>{S.value=!1})}const V=In(),ge=async u=>{if(u.raw){const g=ht(),h={id:g,dataUrl:await gt(u.raw),gps:{accuracy:T.gps.accuracy,coords:{latitude:T.gps.coords.latitude,longitude:T.gps.coords.longitude},timestamp:T.gps.timestamp},shotTime:Date.now()};P.setItem(g,h),p.value.push(h),_.value=h,S.value=!0}},re=ae(null),f=ae({isUploading:!1,current:0,total:0,success:0,failed:0}),D=async()=>{if(p.value.length===0){Z.warning("没有待上传的图片");return}f.value={isUploading:!0,current:0,total:p.value.length,success:0,failed:0};const u=localStorage.getItem("name_token")||"";if(u===""){Z.warning("获取name_token失败，请从邀请链接访问。");return}const g=V.currentRoute.value.params.zoneId,h=[...p.value];for(;h.length>0&&f.value.isUploading;){const b=h.shift();if(b){f.value.current++;try{const J=await(await fetch(b.dataUrl)).blob(),L=new File([J],`photo_${b.shotTime}.jpg`,{type:"image/jpeg"}),K=(b.labels||[]).join(",");await Nn(u,g,L,K),await P.removeItem(b.id.toString());const z=p.value.findIndex(oe=>oe.id===b.id);z!==-1&&p.value.splice(z,1),f.value.success++}catch(N){f.value.failed++,Z.error(`图片 ${f.value.current}/${f.value.total} 上传失败: ${N.message}`),(!b.retryCount||b.retryCount<3)&&(b.retryCount=(b.retryCount||0)+1,h.push(b))}}}f.value.isUploading=!1,f.value.success>0&&Z.success(`上传完成！成功：${f.value.success}，失败：${f.value.failed}`),S.value=!1},w=async(u,g)=>{if(u.checked=g,u=Ae(u),!!u&&_.value){_.value.labels=F.value.filter(h=>h.checked).map(h=>h.label);try{const h=_.value.id.toString(),b=Ae(_.value);await P.setItem(h,b);const N=p.value.findIndex(J=>{var L;return J.id===((L=_.value)==null?void 0:L.id)});N!==-1&&(p.value[N]=_.value)}catch(h){console.log(h),Z.error("标签更新失败: "+h)}}};function R(){const u=A.value;u&&(document.fullscreenElement?document.exitFullscreen():u.requestFullscreen())}return(u,g)=>{var z,oe,we,Ie,ee,pe,Ee,Se,De;const h=he("el-button"),b=he("el-icon"),N=he("el-check-tag"),J=he("el-popconfirm"),L=he("el-upload"),K=he("el-progress");return le(),ue("div",Bn,[U("div",Ln,[ft(U("video",Pn,null,512),[[dt,!S.value]]),k(h,{class:"camera-select",icon:de(hn),circle:"",onClick:H},null,8,["icon"])]),ft(U("div",On,[U("img",{class:"preview-image",ref_key:"imgdrawer",ref:A,onClick:R,src:(z=_.value)==null?void 0:z.dataUrl,alt:""},null,8,Un),U("div",kn,[U("div",Fn,[U("div",Mn,[U("div",$n,"纬度: "+ce((Ie=(we=(oe=_.value)==null?void 0:oe.gps)==null?void 0:we.coords)==null?void 0:Ie.latitude),1),U("div",zn,"经度: "+ce((Ee=(pe=(ee=_.value)==null?void 0:ee.gps)==null?void 0:pe.coords)==null?void 0:Ee.longitude),1)]),U("div",Yn,"GPS Time: "+ce((De=(Se=_.value)==null?void 0:Se.gps)==null?void 0:De.timestamp),1),k(h,{class:"fullscreen-btn",type:"primary",circle:"",onClick:R},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(gn))]),_:1})]),_:1})]),U("div",null,[U("div",Wn,[U("div",Vn,"待上传列表 ("+ce(p.value.length)+")",1),U("div",jn,[(le(!0),ue(ze,null,Ye(p.value,(q,fe)=>(le(),ue("div",{key:fe,class:"thumbnail-item",onClick:ye=>O(q)},[U("img",{src:q.dataUrl,alt:"photo",class:"thumbnail-image"},null,8,Gn)],8,Hn))),128))])]),U("div",Kn,[(le(!0),ue(ze,null,Ye(F.value,(q,fe)=>(le(),ue("div",{key:fe,class:"tag-item"},[k(N,{checked:q.checked,onChange:ye=>w(q,ye)},{default:Q(()=>[me(ce(q.checked?"✓":"")+" "+ce(q.label),1)]),_:2},1032,["checked","onChange"])]))),128))]),U("div",Qn,[k(J,{title:"确认删除?",onConfirm:ne},{reference:Q(()=>[k(h,{class:"preview-btn",type:"danger",round:"",size:"small"},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(pn))]),_:1}),g[1]||(g[1]=me(" 删除 "))]),_:1})]),_:1}),k(h,{class:"preview-btn",type:"success",round:"",size:"small",onClick:D,loading:f.value.isUploading},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(yn))]),_:1}),me(" "+ce(f.value.isUploading?"上传中...":"上传"),1)]),_:1},8,["loading"]),k(h,{class:"preview-btn",type:"info",round:"",size:"small",onClick:g[0]||(g[0]=q=>S.value=!1)},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(_n))]),_:1}),g[2]||(g[2]=me(" 返回 "))]),_:1})])])])],512),[[dt,S.value]]),U("div",Xn,[U("div",Jn,[U("div",qn,"待上传列表 ("+ce(p.value.length)+")",1),U("div",Zn,[(le(!0),ue(ze,null,Ye(p.value,(q,fe)=>(le(),ue("div",{key:fe,class:"thumbnail-item",onClick:ye=>O(q)},[U("img",{src:q.dataUrl,alt:"photo",class:"thumbnail-image"},null,8,tr)],8,er))),128))])]),U("div",nr,[k(h,{class:"action-btn camera-btn",type:"danger",round:"",size:"large",onClick:$},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(bn))]),_:1}),g[3]||(g[3]=me(" 拍照 "))]),_:1}),k(L,{ref_key:"upload",ref:re,"show-file-list":!1,class:"action-btn select-btn",accept:"image/jpeg, image/png, image/gif, image/*",action:"",limit:1,onChange:ge,"auto-upload":!1},{trigger:Q(()=>[k(h,{type:"primary",round:"",size:"large"},{default:Q(()=>[k(b,null,{default:Q(()=>[k(de(wn))]),_:1}),g[4]||(g[4]=me(" 选择照片 "))]),_:1})]),_:1},512)]),f.value.isUploading?(le(),ue("div",rr,[k(K,{percentage:Math.floor(f.value.current/f.value.total*100),format:B,"stroke-width":8},null,8,["percentage"])])):mn("",!0)])])}}}),ur=En(or,[["__scopeId","data-v-db7ff391"]]);export{ur as default};
