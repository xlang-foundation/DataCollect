import{g as E,r as I,d as R}from"./user-D4aDxtNs.js";import{d as $,u as z,r as u,o as A,c as H,e as x,C as J,f as a,t as i,h as t,g as o,H as d,U as j,q as G,v as p,J as h,V as K,l as U,_ as O}from"./index-PZ0i1nac.js";const P={class:"user-container"},Q={class:"header"},W=$({__name:"index",setup(X){const{t:e}=z(),g=u(!1),v=u(!1),m=u(!1),V=u([]),c=u(),C=u(localStorage.getItem("username")||""),n=u({username:"",display_name:"",password:""}),k={username:[{required:!0,message:e("validation.required"),trigger:"blur"},{min:3,max:20,message:e("user.lengthLimit3to20"),trigger:"blur"}],display_name:[{required:!0,message:e("validation.required"),trigger:"blur"}],password:[{required:!0,message:e("validation.required"),trigger:"blur"},{min:6,max:20,message:e("user.lengthLimit6to20"),trigger:"blur"}]},L=r=>r?new Date(r*1e3).toLocaleString():"-",b=async()=>{try{g.value=!0;const r=await E();V.value=r}catch(r){console.error("Failed to fetch users:",r)}finally{g.value=!1}},q=()=>{m.value=!0},B=async()=>{c.value&&await c.value.validate(async r=>{if(r)try{v.value=!0,await I({username:n.value.username,display_name:n.value.display_name,password:n.value.password}),h.success(e("user.addSuccess")),m.value=!1,b()}catch(l){console.error("Failed to add user:",l)}finally{v.value=!1}})},D=async r=>{try{await K.confirm(e("user.deleteUserConfirm",{name:r.display_name}),e("common.warning"),{confirmButtonText:e("common.confirm"),cancelButtonText:e("common.cancel"),type:"warning"}),await R(r.username),h.success(e("common.deleteSuccess")),b()}catch(l){l!=="cancel"&&console.error("Failed to delete user:",l)}},S=()=>{c.value&&c.value.resetFields()};return A(()=>{b()}),(r,l)=>{const f=d("el-button"),_=d("el-table-column"),F=d("el-table"),y=d("el-input"),w=d("el-form-item"),N=d("el-form"),M=d("el-dialog"),T=j("loading");return U(),H("div",P,[x("div",Q,[x("h2",null,i(t(e)("user.userManagement")),1),a(f,{type:"primary",onClick:q},{default:o(()=>[p(i(t(e)("user.addUser")),1)]),_:1})]),J((U(),G(F,{data:V.value,border:"",style:{width:"100%"}},{default:o(()=>[a(_,{prop:"username",label:t(e)("user.username")},null,8,["label"]),a(_,{prop:"display_name",label:t(e)("user.displayName")},null,8,["label"]),a(_,{prop:"last_login",label:t(e)("user.lastLoginTime")},{default:o(({row:s})=>[p(i(L(s.last_login)),1)]),_:1},8,["label"]),a(_,{label:t(e)("common.operation"),width:"150"},{default:o(({row:s})=>[a(f,{type:"danger",size:"small",onClick:Y=>D(s),disabled:s.username===C.value},{default:o(()=>[p(i(t(e)("common.delete")),1)]),_:2},1032,["onClick","disabled"])]),_:1},8,["label"])]),_:1},8,["data"])),[[T,g.value]]),a(M,{modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=s=>m.value=s),title:t(e)("user.addUser"),width:"500px",onClose:S},{footer:o(()=>[a(f,{onClick:l[3]||(l[3]=s=>m.value=!1)},{default:o(()=>[p(i(t(e)("common.cancel")),1)]),_:1}),a(f,{type:"primary",onClick:B,loading:v.value},{default:o(()=>[p(i(t(e)("common.confirm")),1)]),_:1},8,["loading"])]),default:o(()=>[a(N,{ref_key:"formRef",ref:c,model:n.value,rules:k,"label-width":"100px"},{default:o(()=>[a(w,{label:t(e)("user.username"),prop:"username"},{default:o(()=>[a(y,{modelValue:n.value.username,"onUpdate:modelValue":l[0]||(l[0]=s=>n.value.username=s)},null,8,["modelValue"])]),_:1},8,["label"]),a(w,{label:t(e)("user.displayName"),prop:"display_name"},{default:o(()=>[a(y,{modelValue:n.value.display_name,"onUpdate:modelValue":l[1]||(l[1]=s=>n.value.display_name=s)},null,8,["modelValue"])]),_:1},8,["label"]),a(w,{label:t(e)("user.password"),prop:"password"},{default:o(()=>[a(y,{modelValue:n.value.password,"onUpdate:modelValue":l[2]||(l[2]=s=>n.value.password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ae=O(W,[["__scopeId","data-v-1e09c6f2"]]);export{ae as default};
